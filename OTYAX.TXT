ACLS
OPTION STRICT
OPTION DEFINT
 VAR A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z
@OTYAX
GOSUB @OTYAXINIT
GOSUB @OTYAX_MAIN
?"OK
END
'しょきかルーチン
@OTYAXINIT
 ?"OTYAX 5.0
 GOSUB @OTYAXERRORINIT
 GOSUB @OTYAXPROCESSINIT
 GOSUB @OTYAXFILEINIT
 VAR FIRSTPID=0
 VAR FIRSTNUPID=0
 VAR H$="SH"
 I=9

 A OUT I
 NewProcess "SH","" OUT FIRSTPID,FIRSTNUPID,E
RETURN
DEF A OUT B
B=4
END
@OTYAXERRORINIT
 VAR SUCCESS=0
 VAR ERROR_ERROR=1
 VAR ERROR_NOIMPL=2
RETURN
@OTYAXPROCESSINIT
 VAR PROCESS_MAX=128
 DIM PRC_NAME$[PROCESS_MAX]
 DIM PRC_ARGS$[PROCESS_MAX]
 DIM PRC_PID[PROCESS_MAX]
 DIM PRC_STDOUT[PROCESS_MAX]
 DIM PRC_STDERR[PROCESS_MAX]
 DIM PRC_STDIN[PROCESS_MAX]
 DIM PRC_NEXT[PROCESS_MAX]
 DIM PRC_CHILD[PROCESS_MAX]
 DIM PRC_PARENT[PROCESS_MAX]
 VAR PIDCNT=0
 VAR PRC_FREE=1
 FOR I=1 TO PROCESS_MAX-2
  PRC_NEXT[I]=I+1
 NEXT
 VAR RUNNUPID=0
 VAR ERROR_NEW_PROC=8931
RETURN
@OTYAXFILEINIT
 VAR FILES_MAX=1024
 DIM FILES_PID[FILES_MAX]
 DIM FILES_FID[FILES_MAX]
 DIM FILES_NAME$[FILES_MAX]
 DIM FILES_DATA[FILES_MAX]
 DIM FILES_WRITER$[FILES_MAX]
 DIM FILES_READER$[FILES_MAX]
 DIM FILES_CLOSE$[FILES_MAX]
 DIM FILES_NEXT[FILES_MAX]
 VAR FILES_FREE=1
 VAR FILES_FIDCNT=0
 FOR I=1 TO FILES_MAX-2
  FILES_NEXT[I]=I+1
 NEXT
 VAR OTYAX_STDOUT_OPENER$="OUTCONSOLE_OPEN"
 VAR OTYAX_STDIN_OPENER$="INCONSOLE_OPEN"
RETURN

@OTYAX_MAIN
 
RETURN
'OTYAX PROCESS API
DEF NewProcess NAME$,ARGS$ OUT PID,NUPID,E
 IF PRC_FREE==0 THEN @ERROR
 IF !CHKLABEL("@I_"+NAME$) THEN @ERROR
 IF !CHKLABEL("@L_"+NAME$) THEN @ERROR
 INC PIDCNT
 PID=PIDCNT
 NUPID=PRC_FREE
 PRC_FREE=PRC_NEXT[PRC_FREE]
 PRC_NAME$[NUPID]=NAME$
 PRC_ARGS$[NUPID]=ARGS$
 'VAR 
 C=PRC_CHILD[RunNUPID]
 PRC_CHILD[RunNUPID]=NUPID
 PRC_NEXT[NUPID]=C
 E=SUCCESS
 RETURN
 @ERROR
 PID=0
 NUPID=0
 E=ERROR_NEW_PROC
END
'OTYAX FILE API
DEF FileOpen(NAME$)
 RETURN 0
END

DEF OutConsoleOpen OUT FID,NUFID
 IF FILES_FREE==0 THEN
  RETURN
 ENDIF
 INC FILES_FIDCNT
 NUFID=FILES_FREE
 FILES_FID[NUFID]=FILES_FIDCNT
 FILES_WRITER$[NUFID]="CONSOLEWRITERSTR"
 FID=FILES_FIDCNT
 FILES_FREE=FILES_NEXT[FILES_FREE]
 RETURN
END
DEF ConsoleWriterStr(DAT$,FID,NUFID)
 'VAR 
 L=LEN(DAT$)-1
 FOR I=0 TO L
  VAR D$=MID$(DAT$,I,1)
  IF D$==CHR$(13) THEN
   PRINT
  ELSE
   PRINT D$
  ENDIF
 NEXT
END
'OTYAX APPS
@I_SH
RETURN
