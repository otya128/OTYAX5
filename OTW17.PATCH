diff -u OTW.TXT OTW17
--- OTW.TXT
+++ OTW17
@@ -4,7 +4,7 @@
 ' OTYA 3D WINDOW SYSTEM 
 '=======================
 'グローバルへんすうのていぎ
-VAR OTW_INIT,OTW_MOUSESP,OTW_MOVWINSP
+VAR OTW_INIT,OTW_MOUSESP,OTW_MOVWINSP,OTW_MOVWINCOL
 VAR OTW_MOUSEX
 VAR OTW_MOUSEY
 VAR OTW_MOUSEX#,OTW_MOUSEY#
@@ -36,6 +36,8 @@
 DIM WIN_FH1    [0]
 DIM WIN_FW2    [0]
 DIM WIN_FH2    [0]
+DIM WIN_AFW    [0]
+DIM WIN_AFH    [0]
 DIM WIN_CTL    [0]
 DIM WIN_PID    [0]
 DIM WIN_NUPID  [0]
@@ -67,10 +69,10 @@
 VAR OTW_BP
 'GPAGE
 VAR OTW_GP
-VAR WIN_FWIDTH1
-VAR WIN_FHEIGHT1
-VAR WIN_FWIDTH2
-VAR WIN_FHEIGHT2
+'VAR WIN_FWIDTH1
+'VAR WIN_FHEIGHT1
+'VAR WIN_FWIDTH2
+'VAR WIN_FHEIGHT2
 'H1
 '          
 '
@@ -86,10 +88,10 @@
 VAR WIN_ACTIVENUWID
 DEF OTW_WIN_INITARRAY
  VAR FM=FREEMEM
- WIN_FWIDTH1=0
- WIN_FHEIGHT1=10
- WIN_FWIDTH2=0
- WIN_FHEIGHT2=0
+'WIN_FWIDTH1=0
+'WIN_FHEIGHT1=10
+'WIN_FWIDTH2=0
+'WIN_FHEIGHT2=0
  WIN_MAX=256
  WIN_MSGMAX=64
  WIN_MSGARGSIZE=3
@@ -117,6 +119,8 @@
  WIN_FH1       =NewArray(WIN_MAX)
  WIN_FW2       =NewArray(WIN_MAX)
  WIN_FH2       =NewArray(WIN_MAX)
+ WIN_AFW       =NewArray(WIN_MAX)
+ WIN_AFH       =NewArray(WIN_MAX)
  WIN_CTL       =NewArray(WIN_MAX)
  WIN_PID       =NewArray(WIN_MAX)
  WIN_NUPID     =NewArray(WIN_MAX)
@@ -223,7 +227,8 @@
  CTL_BTNDWNFLG=1
  CTL_BTNUPFLG=2
 ' CTL_DRWFRMHANDLER=3
- E=SetControlFrameSize(CTL_WINDOWCTL,WIN_FWIDTH1,WIN_FHEIGHT1,WIN_FWIDTH2,WIN_FHEIGHT2)
+'E=SetControlFrameSize(CTL_WINDOWCTL,WIN_FWIDTH1,WIN_FHEIGHT1,WIN_FWIDTH2,WIN_FHEIGHT2)
+ E=SetControlFrameSize(CTL_WINDOWCTL,1,11,1,1)
  E=SetControlPainter(CTL_WINDOWCTL,"WindowPainter")
  E=SetControlLMouseUpHandler(CTL_WINDOWCTL,"WindowLMouseUP")
  E=SetControlClickFrameHandler(CTL_WINDOWCTL,"WindowClickFrame")
@@ -451,8 +456,10 @@
  WIN_FH1[NUWID]=CTL_FH1[NC]
  WIN_FW2[NUWID]=CTL_FW1[NC]+CTL_FW2[NC]
  WIN_FH2[NUWID]=CTL_FH1[NC]+CTL_FH2[NC]
- WIN_WIDTH[NUWID]=WIDTH+WIN_FW2[NUWID]
- WIN_HEIGHT[NUWID]=HEIGHT+WIN_FH2[NUWID]
+ INC WIDTH,WIN_FW2[NUWID]
+ WIN_WIDTH[NUWID]=WIDTH
+ INC HEIGHT,WIN_FH2[NUWID]
+ WIN_HEIGHT[NUWID]=HEIGHT
  WIN_AW[NUWID]=WIN_WIDTH[NUWID]
  WIN_AH[NUWID]=WIN_HEIGHT[NUWID]
  WIN_FX[NUWID]=WIN_AX[NUWID]+WIN_FW1[NUWID]
@@ -461,30 +468,9 @@
  WIN_RFY[NUWID]=WIN_FY[NUWID]
  WIN_RX[NUWID]=WIN_AX[NUWID]
  WIN_RY[NUWID]=WIN_AY[NUWID]
- IF WIN_FX[PNUWID]>WIN_RX[NUWID]THEN
-  WIN_RX[NUWID]=WIN_FX[PNUWID]
- ENDIF
- IF WIN_FY[PNUWID]>WIN_RY[NUWID]THEN
-  WIN_RY[NUWID]=WIN_FY[PNUWID]
- ENDIF
- VAR E1=WIN_AX[NUWID]+WIDTH
- VAR E2=WIN_AX[PNUWID]+WIN_AW[PNUWID]
- IF E1>E2 THEN
-  DEC WIN_AW[NUWID],E1-E2
-  IF WIN_RFX[PNUWID]>WIN_RFX[NUWID]THEN
-   WIN_RFX[NUWID]=WIN_RFX[PNUWID]
-  ENDIF
- ENDIF
- E1=WIN_AY[NUWID]+HEIGHT
- E2=WIN_AY[PNUWID]+WIN_AH[PNUWID]
- IF E1>E2 THEN
-  DEC WIN_AH[NUWID],E1-E2
-  IF WIN_RFY[PNUWID]>WIN_RFY[NUWID]THEN
-   WIN_RFY[NUWID]=WIN_RFY[PNUWID]
-  ENDIF
- ENDIF
  WIN_NEXT[NUWID]=0
  WIN_PARENT[NUWID]=PARENT AND NUWIDMASK
+ OTW_CLIPWindow NUWID
  IF PNUWID THEN 
   IF FLG AND WindowFrontFlag()THEN
    IF WIN_CHILD[PNUWID]THEN
@@ -607,8 +593,8 @@
  WIN_FH1[NUWID]=CTL_FH1[NUCID]'WIN_TOPLEVELY
  WIN_AX[NUWID]=WIN_TopLevelX
  WIN_AY[NUWID]=WIN_TOPLEVELY
- INC WIN_TopLevelX,WIN_FHEIGHT1
- INC WIN_TopLevelY,WIN_FHEIGHT1
+ INC WIN_TopLevelX,CTL_FH1[NUCID]'WIN_FHEIGHT1
+ INC WIN_TopLevelY,CTL_FH1[NUCID]'WIN_FHEIGHT1
  WIN_RX[NUWID]=WIN_AX[NUWID]
  WIN_RY[NUWID]=WIN_AY[NUWID]
  WIN_FX[NUWID]=WIN_AX[NUWID]+WIN_FW1[NUWID]
@@ -620,9 +606,11 @@
 ' WIN_WIDTH[NUWID]=WIDTH+WIN_FWIDTH+
 ' WIN_HEIGHT[NUWID]=HEIGHT
  
- WIN_HEIGHT[NUWID]=WIN_HEIGHT[NUWID]+WIN_FHEIGHT1
+ WIN_HEIGHT[NUWID]=WIN_HEIGHT[NUWID]+CTL_FH1[NUCID]+CTL_FH2[NUCID]
+ WIN_WIDTH[NUWID]=WIN_WIDTH[NUWID]+CTL_FW1[NUCID]+CTL_FW2[NUCID]
  WIN_AW[NUWID]=WIN_WIDTH[NUWID]
  WIN_AH[NUWID]=WIN_HEIGHT[NUWID]
+ OTW_CLIPWindow NUWID
  OTW_DrawMap NUWID
  GCLIP 1,0,0,400,240
 ' GFILL WIN_AX[NUWID],WIN_AY[NUWID],WIN_AX[NUWID]+WIN_WIDTH[NUWID],WIN_AY[NUWID]+WIN_HEIGHT[NUWID],RGB(255,255,255)
@@ -704,7 +692,12 @@
  GPAGE OTW_SP,OTW_DP
  GCLIP 1,0,240,400,480
  GFILL WIN_RX[NUWID],WIN_RY[NUWID]+240,WIN_RX[NUWID]+WIN_AW[NUWID],WIN_RY[NUWID]+WIN_AH[NUWID]+240,ShortToRGB(WIN_FRAMEFLG OR NUWID)
- GFILL WIN_RFX[NUWID],WIN_RFY[NUWID]+240,WIN_RFX[NUWID]+WIN_AW[NUWID]-WIN_FW2[NUWID],WIN_RFY[NUWID]+240+WIN_AH[NUWID]-WIN_FH2[NUWID],ShortToRGB(NUWID)
+'VAR W=WIN_AW[NUWID]-WIN_FW2[NUWID]
+'VAR H=WIN_AH[NUWID]-WIN_FH2[NUWID]
+'IF WIN_WIDTH[NUWID]!=WIN_AW[NUWID]THEN INC W,WIN_FW1[NUWID]
+'IF WIN_HEIGHT[NUWID]!=WIN_AH[NUWID]THEN INC H,WIN_FH1[NUWID]
+'GFILL WIN_RFX[NUWID],WIN_RFY[NUWID]+240,WIN_RFX[NUWID]+W,WIN_RFY[NUWID]+240+H,ShortToRGB(NUWID)
+ GFILL WIN_RFX[NUWID],WIN_RFY[NUWID]+240,WIN_RFX[NUWID]+WIN_AFW[NUWID],WIN_RFY[NUWID]+240+WIN_AFH[NUWID],ShortToRGB(NUWID)
  GCLIP 1,0,0,400,240
 END
 COMMON DEF FrontWindow(WND)
@@ -799,24 +792,7 @@
 '  NXT=WIN_NEXT[NXT]
 ' WEND
 END
-COMMON DEF MoveWindow(WND,X,Y)
- IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
- IF!X&&!Y THEN RETURN
- VAR NUWID=WND AND NUWIDMASK
- VAR MX=X-WIN_AX[NUWID],MY=Y-WIN_AY[NUWID]
- VAR NXT=WIN_CHILD[NUWID],B=NXT
- IF WIN_PARENT[NUWID]==(WIN_ROOTWND AND NUWIDMASK)THEN
-' GFILL WIN_RX[NUWID],WIN_RY[NUWID],WIN_RX[NUWID]+WIN_AW[NUWID],WIN_RY[NUWID]+WIN_AH[NUWID],0
- ENDIF
-' GFILL WIN_AX[NUWID],WIN_AY[NUWID],WIN_AX[NUWID]+WIN_WIDTH[NUWID],WIN_AY[NUWID]+WIN_HEIGHT[NUWID],0
- WIN_AX[NUWID]=WIN_AX[NUWID]+MX
- WIN_AY[NUWID]=WIN_AY[NUWID]+MY
- WIN_FX[NUWID]=WIN_AX[NUWID]+WIN_FW1[NUWID]
- WIN_FY[NUWID]=WIN_AY[NUWID]+WIN_FH1[NUWID]
- WIN_RFX[NUWID]=WIN_FX[NUWID]
- WIN_RFY[NUWID]=WIN_FY[NUWID]
- WIN_RX[NUWID]=WIN_AX[NUWID]
- WIN_RY[NUWID]=WIN_AY[NUWID]
+COMMON DEF OTW_CLIPWindow NUWID
  VAR PNUWID=WIN_PARENT[NUWID]
  IF WIN_FX[PNUWID]>WIN_RX[NUWID]THEN
   WIN_RX[NUWID]=WIN_FX[PNUWID]
@@ -832,26 +808,78 @@
  ENDIF
  VAR E1=WIN_AX[NUWID]+WIN_WIDTH[NUWID]
  VAR E2=WIN_RX[PNUWID]+WIN_AW[PNUWID]
-
+ 'CLIP FRAME
+ IF WIN_WIDTH[PNUWID]==WIN_AW[PNUWID]THEN
+  DEC E2,WIN_FW2[PNUWID]-WIN_FW1[PNUWID]
+ ENDIF
  WIN_AW[NUWID]=WIN_WIDTH[NUWID]
  IF E1>E2 THEN
- DEC WIN_AW[NUWID],E1-E2
+  DEC WIN_AW[NUWID],E1-E2
  ENDIF
  IF WIN_AX[NUWID]<WIN_FX[PNUWID]THEN
- WIN_AW[NUWID]=WIN_WIDTH[NUWID]
-  DEC WIN_AW[NUWID],WIN_FX[PNUWID]-WIN_AX[NUWID]
+  WIN_AW[NUWID]=WIN_WIDTH[NUWID]
+  DEC WIN_AW[NUWID],WIN_FX[PNUWID]-WIN_AX[NUWID]'-WIN_FW2[PNUWID]-WIN_FW1[PNUWID]
  ENDIF
  E1=WIN_RY[NUWID]+WIN_HEIGHT[NUWID]
  E2=WIN_RY[PNUWID]+WIN_AH[PNUWID]
  WIN_AH[NUWID]=WIN_HEIGHT[NUWID]
 
+ 'CLIP FRAME
+ IF WIN_HEIGHT[PNUWID]==WIN_AH[PNUWID]THEN
+  DEC E2,WIN_FH2[PNUWID]-WIN_FH1[PNUWID]
+ ENDIF
  IF E1>E2 THEN
   DEC WIN_AH[NUWID],E1-E2
  ENDIF
  IF WIN_AY[NUWID]<WIN_FY[PNUWID]THEN
- WIN_AH[NUWID]=WIN_HEIGHT[NUWID]
-  DEC WIN_AH[NUWID],WIN_FY[PNUWID]-WIN_AY[NUWID]
+  WIN_AH[NUWID]=WIN_HEIGHT[NUWID]
+  DEC WIN_AH[NUWID],WIN_FY[PNUWID]-WIN_AY[NUWID]'WIN_FH1[NUWID]
  ENDIF
+
+ VAR W=WIN_AW[NUWID]
+ VAR H=WIN_AH[NUWID]
+ IF W==WIN_WIDTH[NUWID]THEN
+  DEC W,WIN_FW2[NUWID]
+ ELSE
+  DEC W,WIN_FW2[NUWID]-WIN_FW1[NUWID]
+ ENDIF
+ IF H==WIN_HEIGHT[NUWID]THEN
+  DEC H,WIN_FH2[NUWID]
+ ELSE
+  IF WIN_HEIGHT[NUWID]-H>=WIN_FH1[NUWID]THEN
+    DEC H,WIN_FH2[NUWID]-WIN_FH1[NUWID]
+
+'   IF WIN_RFY[NUWID]==WIN_RY[NUWID]THEN
+'    DEC H,WIN_FH1[NUWID]
+'   ELSE
+'    DEC H,WIN_FH2[NUWID]-WIN_FH1[NUWID]
+'   ENDIF
+  ELSE
+   DEC H,WIN_FH1[NUWID]-(WIN_HEIGHT[NUWID]-H)+1
+  ENDIF
+ ENDIF
+ WIN_AFW[NUWID]=W
+ WIN_AFH[NUWID]=H
+END
+COMMON DEF MoveWindow(WND,X,Y)
+ IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
+ VAR NUWID=WND AND NUWIDMASK
+ VAR MX=X-WIN_AX[NUWID],MY=Y-WIN_AY[NUWID]
+ IF!MX&&!MY THEN RETURN FrontWindow(WND)
+ VAR NXT=WIN_CHILD[NUWID],B=NXT
+ IF WIN_PARENT[NUWID]==(WIN_ROOTWND AND NUWIDMASK)THEN
+' GFILL WIN_RX[NUWID],WIN_RY[NUWID],WIN_RX[NUWID]+WIN_AW[NUWID],WIN_RY[NUWID]+WIN_AH[NUWID],0
+ ENDIF
+' GFILL WIN_AX[NUWID],WIN_AY[NUWID],WIN_AX[NUWID]+WIN_WIDTH[NUWID],WIN_AY[NUWID]+WIN_HEIGHT[NUWID],0
+ WIN_AX[NUWID]=WIN_AX[NUWID]+MX
+ WIN_AY[NUWID]=WIN_AY[NUWID]+MY
+ WIN_FX[NUWID]=WIN_AX[NUWID]+WIN_FW1[NUWID]
+ WIN_FY[NUWID]=WIN_AY[NUWID]+WIN_FH1[NUWID]
+ WIN_RFX[NUWID]=WIN_FX[NUWID]
+ WIN_RFY[NUWID]=WIN_FY[NUWID]
+ WIN_RX[NUWID]=WIN_AX[NUWID]
+ WIN_RY[NUWID]=WIN_AY[NUWID]
+ OTW_CLIPWindow NUWID
 ' STOP
 ' WIN_AH[NUWID]=WIN_HEIGHT[NUWID]
 ' IF WIN_AX[PNUWID]>WIN_RX[NUWID]THEN
@@ -1072,8 +1100,11 @@
  RETURN WIN_WIDTH[WND AND NUWIDMASK]
 END
 DEF GetWindowFrameHeight(WND)
- RETURN WIN_FHEIGHT1
+ RETURN WIN_FH1[WND AND NUWIDMASK]'CTL_FH2[NUCID]
 END
+DEF GetWindowFrameHeight2(WND)
+ RETURN WIN_FH2[WND AND NUWIDMASK]'CTL_FH2[NUCID]
+END
 common def GetWindowName$(wnd)
  return win_name$[wnd and nuwidmask]
 end
@@ -1152,29 +1183,39 @@
  IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
  VAR NUWID=WND AND NUWIDMASK
  IF WIN_BEGIN[NUWID]==1THEN RETURN WIN_EVENTERR
- IF WIN_BEGIN[NUWID]==2THEN RETURN 0
- WIN_BEGIN[NUWID]=TRUE
  VAR AX=WIN_RFX[NUWID]'WIN_FW1[NUWID]
  VAR AY=WIN_RFY[NUWID]'WIN_FH1[NUWID]
  VAR W=WIN_AW[NUWID]
  VAR H=WIN_AH[NUWID]
+ IF W==WIN_WIDTH[NUWID]THEN
+  DEC W,WIN_FW2[NUWID]
+ ELSE
+  DEC W,WIN_FW2[NUWID]-WIN_FW1[NUWID]
+ ENDIF
+ IF H==WIN_HEIGHT[NUWID]THEN
+  DEC H,WIN_FH2[NUWID]
+ ELSE
+  IF WIN_HEIGHT[NUWID]-H>=WIN_FH1[NUWID]THEN
+   DEC H,WIN_FH2[NUWID]-WIN_FH1[NUWID]
+  ELSE
+   DEC H,WIN_FH1[NUWID]-(WIN_HEIGHT[NUWID]-H)+1
+'WIN_HEIGHT[NUWID]-H'WIN_FH2[NUWID]-WIN_FH1[NUWID]
+  ENDIF
+ ENDIF
+ W=WIN_AFW[NUWID]
+ H=WIN_AFH[NUWID]
  GPAGE OTW_SP,OTW_BP
  GCLIP 1,AX,AY,AX+W,AY+H
- IF WIN_BEGIN[NUWID]==2THEN RETURN 0
+ IF WIN_BEGIN[NUWID]>=2THEN RETURN 0
+ WIN_BEGIN[NUWID]=TRUE
  GCLS
  RETURN 0
 END
 DEF ReGBeginWindow(WND)
  IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
  VAR NUWID=WND AND NUWIDMASK
- INC WIN_BEGIN[NUWID]
- VAR AX=WIN_RFX[NUWID]'WIN_FW1[NUWID]
- VAR AY=WIN_RFY[NUWID]':IN_FH1[NUWID]
- VAR W=WIN_AW[NUWID]
- VAR H=WIN_AH[NUWID]
- GPAGE OTW_SP,OTW_BP
- GCLIP 1,AX,AY,AX+W,AY+H
- RETURN 0
+ WIN_BEGIN[NUWID]=2
+ RETURN GBeginWindow(WND)
 END
 DEF GBeginFrameWindow(WND)
  IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
@@ -1197,20 +1238,33 @@
  'ごうせい
  WIN_PARENT[0]=0
  WIN_NEXT[0]=0
- WIN_BEGIN[NUWID]=FALSE
  VAR AX=WIN_RX[NUWID]
  VAR AY=WIN_RY[NUWID]
  VAR W=WIN_AW[NUWID]
  VAR H=WIN_AH[NUWID]
+ IF WIN_BEGIN[NUWID]!=2THEN
+  AX=WIN_RFX[NUWID]
+  AY=WIN_RFY[NUWID]
+  IF W==WIN_WIDTH[NUWID]THEN DEC W,WIN_FW2[NUWID]'-WIN_FW1[NUWID]
+  IF H==WIN_HEIGHT[NUWID]THEN DEC H,WIN_FH2[NUWID]'-WIN_FH1[NUWID]
+ ENDIF
+ WIN_BEGIN[NUWID]=FALSE
  GCLIP 1,AX,AY,AX+W,AY+H
  VAR PNUWID
  IF WIN_CHILD[NUWID]THEN
   PNUWID=WIN_CHILD[NUWID]
+  VAR W2=W,H2=H
+  IF W==WIN_WIDTH[NUWID]THEN DEC W,WIN_FW2[NUWID]-WIN_FW1[NUWID]
+ IF H==WIN_HEIGHT[NUWID]THEN DEC H,WIN_FH2[NUWID]-WIN_FH1[NUWID]
+  GCLIP 1,AX,AY,AX+W,AY+H
   WHILE PNUWID
    GCOPY OTW_DP,WIN_RX[PNUWID],WIN_RY[PNUWID],WIN_RX[PNUWID]+WIN_AW[PNUWID],WIN_RY[PNUWID]+WIN_AH[PNUWID],WIN_RX[PNUWID],WIN_RY[PNUWID],0
 
    PNUWID=WIN_NEXT[PNUWID]
   WEND
+  W=W2
+  H=H2
+  GCLIP 1,AX,AY,AX+W,AY+H
  ENDIF
  VAR _NUWID=NUWID
  PNUWID=WIN_NEXT[NUWID]
@@ -1329,15 +1383,21 @@
  VAR E=GBeginFrameWindow(WND)
  IF E THEN RETURN
  GFILLWindow WND,0,-GetWindowFrameHeight(WND),GetWindowFrameWidth(WND),-1,RGB(0,0,255)
- GPRINTWindowCC WND,1,-GetWindowFrameHeight(WND)+1,GetWindowName$(WND),15
+ GPRINTWindowCC WND,1,-GetWindowFrameHeight(WND)+2,GetWindowName$(WND),15
  VAR H=GetWindowFrameHeight(WND)
  VAR W=GetWindowFrameWidth(WND)
  VAR C=RGB(224,224,224)
- GFILLWindow WND,W-09,-H,W,-1,RGB(224,0,0)
- GLINEWindow WND,W-08,-H+2,W-2,-2,C
- GLINEWindow WND,W-7,-H+2,W-1,-2,C
- GLINEWindow WND,W-2,-H+2,W-8,-2,C
- GLINEWindow WND,W-1,-H+2,W-7,-2,C
+ GFILLWindow WND,W-09-1,-H+1,W-1,-1,RGB(224,0,0)
+ GLINEWindow WND,W-08-1,-H+2+1,W-2-1,-2,C
+ GLINEWindow WND,W-7-1,-H+2+1,W-1-1,-2,C
+ GLINEWindow WND,W-2-1,-H+2+1,W-8-1,-2,C
+ GLINEWindow WND,W-1-1,-H+2+1,W-7-1,-2,C
+'GLINEWindow WND,-1,-H,W-1,-H,RGB(224,224,224)
+ VAR H2=WIN_HEIGHT[WND AND NUWIDMASK]-H
+'GLINEWindow WND,-1,-H,-1,H2-1,RGB(224,224,224)
+'GLINEWindow WND,W-1,-H,W-1,H2,RGB(0,0,0)
+'GLINEWindow WND,-1,H2,W-1,H2,RGB(0,0,0)
+ GBOXWindow WND,-1,-H,W-1,H2,RGB(0,0,0)
  E=ReGBeginWindow(WND)
 ' E=GEndWindow(WND)
 END
@@ -1364,7 +1424,7 @@
    IF SetWindowDragHandler("WindowDragFrame",WND,AX-X,AY-Y)THEN RETURN
    SPSHOW OTW_MOVWINSP
    SPSCALE OTW_MOVWINSP,WIN_WIDTH[NUWID]+1,WIN_HEIGHT[NUWID]+1
-   SPCOLOR OTW_MOVWINSP,RGB(128,80,208,255)
+   SPCOLOR OTW_MOVWINSP,OTW_MOVWINCOL
    SPOFS OTW_MOVWINSP,AX-X,AY-Y,-256
    SPLINK OTW_MOVWINSP,OTW_MOUSESP
    SPVAR OTW_MOVWINSP,1,NUWID
@@ -1592,10 +1652,11 @@
 '    GLINE 0,I+60*J,400,I+60*J,RGB(0,I*4,I*4) '
  ' NEXT
 ' NEXT
-  GCLS 
+  GCLS RGB(0,192,0)
   FOR I=-400TO 400 STEP 2
-   GLINE I,0,I+400,400,RGB(0,255,0)'RGB(255,255,255)
+   GLINE I,0,I+400,400,RGB(0,0,255)'RGB(255,255,255)
   NEXT
+  GCLS RGB(0,224,224)
   GPAGE OTW_SP,OTW_DP
   GPRIO 1023
   GCLS RGB(0,192,128)
@@ -1650,7 +1711,7 @@
   E=SetControlPainter(WIN_ROOTCTL,"DesktopPainter")
   NewTopLevelWindow WIN_ROOTCTL,"DESKTOP",400,240 OUT WIN_ROOTWND,E
   ExtendControl "HELLO",GetWindowControl() OUT TSTCTL,E
-' NewTopLevelWindow TSTCTL,"HELLO",64,64 OUT TSTWND,E
+ NewTopLevelWindow TSTCTL,"HELLO",64,64 OUT TSTWND,E
 ' NewTopLevelWindow TSTCTL,"HELLO",64,64 OUT TSTWND2,E
 ' NewTopLevelWindow TSTCTL,"HELLO",64,64 OUT TSTWND3,E
   E=SetControlPainter(TSTCTL,"HELLOPainter")
@@ -1684,6 +1745,9 @@
   SPSET OTW_MOVWINSP,0
   SPHIDE OTW_MOVWINSP
   SPVAR OTW_MOVWINSP,0,1
+  OTW_MOVWINCOL=RGB(128,128,128,128)
+  OTW_MOVWINCOL=RGB(128,255,255,255)
+  SPCOLOR OTW_MOVWINSP,OTW_MOVWINCOL
   CLS
   LOCATE 0,29
   NewProcess"LAUNCHER","" OUT E,E,E
@@ -1696,7 +1760,7 @@
  VAR E=CallBaseControlHandler(WND,CTL,TYPE,A1,A2)
  E=GBEGINWindow(WND)
  IF E THEN RETURN
- GFILLWindow WND,0,0,64,64,RGB(224,224,224)'RGB(0,0,0)
+ GFILLWindow WND,0,0,64,64,RGB(224-224,224,224)'RGB(0,0,0)
  VAR S$="HELLOWORLD",I
  FOR I=0TO LEN(S$)-1
   GPRINTWindowCC WND,6+I*8,1,S$[I],I
@@ -1766,7 +1830,7 @@
  ENDIF
  VOID UpdateWindowOnly(WIN_ROOTWND)
 'E=UpdateWindow(TSTWND2)
-'E=UpdateWindow(TSTWND)
+E=UpdateWindow(TSTWND)
 'E=UpdateWindow(TSTWND3)
  OTW_FDIFF=MAINCNT-OTW_FCNT
  IF OTW_FDIFF>1 THEN
@@ -1823,6 +1887,7 @@
  IF E THEN ExitProcess 0
 END
 VAR ABOUTCTL
+DIM OTWLOGO[0]
 COMMON DEF I_ABOUT
  IF!CHKCALL("IsWinRunning")||!IsWinRunning()THEN
   PrintConsole "Require OTW"+LF$()
@@ -1830,14 +1895,18 @@
   RETURN
  ENDIF
  VAR E
- ExtendControl "ABOUT",GetWindowControl() OUT ABOUTCTL,E
+ IF!ABOUTCTL THEN
+  ExtendControl "ABOUT",GetWindowControl() OUT ABOUTCTL,E
+  OTWLOGO=NewArray(0)
+  LOAD"DAT:OTWLOGORC",OTWLOGO,0
+ ENDIF
  VAR WND
- NewTopLevelWindow ABOUTCTL,"OTW",128,32 OUT WND,E
+ NewTopLevelWindow ABOUTCTL,"OTW",144,64 OUT WND,E
  IF E THEN BEEP:ExitProcess 1
  SetProcessVar WND
  E=SetControlPainter(ABOUTCTL,"AboutPainter")
  E=SetControlNotificationHandler(ABOUTCTL,"ABOUTNotif")
- NewWindow GetButtonControl(),"OK",54,16,20,12,WND,0 OUT E,E
+ NewWindow GetButtonControl(),"OK",(144-20)/2,16,20,12,WND,0 OUT E,E
 END
 COMMON DEF AboutNotif WND,CTL,TYPE,A1,A2
  VOID Deletewindow(WND)
@@ -1846,8 +1915,17 @@
  VAR E=CallBaseControlHandler(WND,CTL,TYPE,A1,A2)
 ' E=GBeginWindow(WND)
  IF E THEN RETURN
- GPRINTWindow WND,0,0," otya 3D window ",RGB(0,0,0)
- GPRINTWindow WND,0,8,"   system 5.0   ",RGB(0,0,0)
+ VAR S$="otya 3D window"
+ GPRINTWindow WND,(144-LEN(S$)*8)/2,0,S$,RGB(0,0,0)
+ S$="system 5.0"
+ GPRINTWindow WND,(144-LEN(S$)*8)/2,8,S$,RGB(0,0,0)
+ GLOADWindow WND,1,1,16,16,OTWLOGO,1,0
+ S$="Logo designed by"
+ GPRINTWindow WND,(144-LEN(S$)*8)/2,30,S$,RGB(0,0,0)
+ S$="mintyan"
+ GPRINTWindow WND,(144-LEN(S$)*8)/2,38,S$,RGB(0,0,0)
+ S$="© 2011-2015 otya"
+ GPRINTWindow WND,(144-LEN(S$)*8)/2,46+4,S$,RGB(0,0,0)
  E=GEndWindow(WND)
 END
 COMMON DEF L_ABOUT
@@ -1969,7 +2047,7 @@
   VAR E
   E=GBeginWindow(WCLOCKWND)
   IF E THEN RETURN
-  GFILLWindow WCLOCKWND,0,0,64,64,RGB(255,160,16)
+  GCLSWindow WCLOCKWND,RGB(224,224,224)'255,160,16)
   GPRINTWindowCC WCLOCKWND,0,0,TIME$,1
   GPRINTWindowCC WCLOCKWND,0,8,TIME$,1
   GPRINTWindowCC WCLOCKWND,0,56,TIME$,1
@@ -2256,7 +2334,6 @@
  GCLSWindow WND,RGB(255,255,255)
  VAR W=GetWindowWidth(WND)
  VAR H=GetWindowHeight(WND)
- GBOXWindow WND,0,0,W,H,RGB(0,0,0)
  VAR L=GetWindowVar(WND,1)
  VAR C=GetWindowVar(WND,2)
  VAR V$=TXTBOXEX_VAL$[C]
@@ -2299,6 +2376,7 @@
    BREAK
   ENDIF
  WEND
+ GBOXWindow WND,0,0,W,H,RGB(0,0,0)
  E=GEndWindow(WND)
  SetWindowVar WND,6,PL
 END
@@ -2906,17 +2984,58 @@
  FOR I=0TO 15
   READ PAL[I]
  NEXT
+ OTW_FNT=NewArray2(1024,64)
+ OTW_FNTTMP=NewArray(64)
+ OTW_FNTPAL=NewArray(2)
+ OTW_FNTTBL=NewArray(65536)
+ FOR I=1TO 65535
+  OTW_FNTTBL[I]=703
+ NEXT
+ OTW_FNTTBL[10]=13
+ OTW_LOADFNTTBL
+ IF!CHKFILE("DAT:OTW_FONT")THEN
+  OTW_GENFONT
+ ELSE
+  LOAD"DAT:OTW_FONT",OTW_FNT,0
+ ENDIF
+ @FONT
+ '      AARRGGBB
+DATA &H00000000
+DATA &HFF000000
+DATA &HFF7F0000
+DATA &HFFFF0000
+DATA &HFF007F00
+DATA &HFF00FF00
+DATA &HFF7F7F00
+DATA &HFFFFFF00
+DATA &HFF00007F
+DATA &HFF0000FF
+DATA &HFF7F007F
+DATA &HFFFF00FF
+DATA &HFF007F7F
+DATA &HFF00FFFF
+DATA &HFF7F7F7F
+DATA &HFFFFFFFF
+END
+DEF OTW_GENFONT
+ VAR I
  IF!CHKFILE("DAT:FONT")THEN
   SAVE "GRPF:FONT"
-  IF RESULT==-1THEN SAVE "GRPF:FONT"
+  IF RESULT==-1 THEN SAVE "GRPF:FONT"
   '2かいもやめたならしかたない
+  IF RESULT!=1 THEN
+   FOR I=0TO 63
+    READ OTW_FNT[703,I]
+   NEXT
+   FOR I=1TO 65535
+    OTW_FNTTBL[I]=703
+   NEXT
+   RETURN
+  ENDIF
  ENDIF
  LOAD"GRP1:FONT",0
  VAR L
- OTW_FNT=NewArray2(1024,64)
- OTW_FNTTMP=NewArray(64)
- OTW_FNTPAL=NewArray(2)
- OTW_FNTTBL=NewArray(65536)
+ VAR X,Y,J,K
  GPAGE 0,1
  FOR I=0TO 1023
   X=I*8
@@ -2933,29 +3052,20 @@
    NEXT
   NEXT
  NEXT
- OTW_FNTTBL[10]=13
+ SAVE"DAT:OTW_FONT",OTW_FNT
+ GCLS 
  GPAGE 0,0
- OTW_LOADFNTTBL
 @FONT
 RETURN
 COLOR
-'      AARRGGBB
-DATA &H00000000
-DATA &HFF000000
-DATA &HFF7F0000
-DATA &HFFFF0000
-DATA &HFF007F00
-DATA &HFF00FF00
-DATA &HFF7F7F00
-DATA &HFFFFFF00
-DATA &HFF00007F
-DATA &HFF0000FF
-DATA &HFF7F007F
-DATA &HFFFF00FF
-DATA &HFF007F7F
-DATA &HFF00FFFF
-DATA &HFF7F7F7F
-DATA &HFFFFFFFF
+DATA 1,1,1,1,1,1,1,0'"FFFFFFF0"
+DATA 1,0,1,1,1,0,1,0'"F0FFF0F0"
+DATA 1,1,0,1,0,1,1,0'"FF0F0FF0"
+DATA 1,1,1,0,1,1,1,0'"FFF0FFF0"
+DATA 1,1,0,1,0,1,1,0'"FF0F0FF0"
+DATA 1,0,1,1,1,0,1,0'"F0FFF0F0"
+DATA 1,1,1,1,1,1,1,0'"FFFFFFF0"
+DATA 0,0,0,0,0,0,0,0'"00000000"
 DATA "0"
 DATA &B00111000'"00FFF000"
 DATA &B01000100
