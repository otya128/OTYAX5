diff -u OTW.TXT OTW6
--- OTW.TXT
+++ OTW6
@@ -8,6 +8,9 @@
 VAR OTW_MOUSEX
 VAR OTW_MOUSEY
 VAR OTW_MOUSEX#,OTW_MOUSEY#
+VAR OTW_FNT1[0]'0x20~0x7F
+VAR OTW_FNT2[0]'
+VAR OTW_FNT3[0]'
 '=======================
 '        WINDOW         
 '=======================
@@ -16,10 +19,6 @@
 DIM WIN_WID    [0]
 DIM WIN_X      [0]
 DIM WIN_Y      [0]
-DIM WIN_SX     [0]
-DIM WIN_SY     [0]
-DIM WIN_EWIDTH [0]
-DIM WIN_EHEIGHT[0]
 DIM WIN_WIDTH  [0]
 DIM WIN_HEIGHT [0]
 DIM WIN_AX     [0]
@@ -35,6 +34,7 @@
 DIM WIN_CHILD  [0]
 DIM WIN_PARENT [0]
 DIM WIN_BEGIN  [0]
+DIM WIN_SP     [0]
 'QUEUE
 DIM WIN_MSGS   [0]
 DIM WIN_MSGE   [0]
@@ -46,6 +46,8 @@
 VAR NUWIDMASK
 'DRAW PAGE
 VAR OTW_DP
+'SHOW PAGE
+VAR OTW_SP
 'BUFFER PAGE
 VAR OTW_BP
 DEF OTW_WIN_INITARRAY
@@ -54,16 +56,10 @@
  WIN_MSGARGSIZE=3
  WIDSHIFT=12
  NUWIDMASK=4095
- OTW_DP=0
- OTW_BP=1
  WIN_NAME$     =NewArray$(WIN_MAX)
  WIN_WID       =NewArray(WIN_MAX)
  WIN_X         =NewArray(WIN_MAX)
  WIN_Y         =NewArray(WIN_MAX)
- WIN_SX        =NewArray(WIN_MAX)
- WIN_SY        =NewArray(WIN_MAX)
- WIN_EWIDTH    =NewArray(WIN_MAX)
- WIN_EHEIGHT   =NewArray(WIN_MAX)
  WIN_WIDTH     =NewArray(WIN_MAX)
  WIN_HEIGHT    =NewArray(WIN_MAX)
  WIN_AX        =NewArray(WIN_MAX)
@@ -79,6 +75,7 @@
  WIN_CHILD     =NewArray(WIN_MAX)
  WIN_PARENT    =NewArray(WIN_MAX)
  WIN_BEGIN     =NewArray(WIN_MAX)
+ WIN_SP        =NewArray(WIN_MAX)
  WIN_MSGS      =NewArray(WIN_MAX)
  WIN_MSGE      =NewArray(WIN_MAX)
  WIN_MSGBUF    =NewArray3(WIN_MAX,WIN_MSGMAX,WIN_MSGARGSIZE)
@@ -99,6 +96,8 @@
 VAR CTL_FREE
 VAR CTL_CIDCNT
 VAR CTL_PAINTHANDLER
+VAR CTL_LBTNUPHANDLER
+VAR CTL_LBTNDWNHANDLER
 VAR CTL_WINDOWCTL
 DEF OTW_CTL_INITARRAY
  CTL_MAX=64
@@ -113,7 +112,10 @@
  VAR E
  NewControl "WINDOW" OUT CTL_WINDOWCTL,E
  CTL_PAINTHANDLER=0
+ CTL_LBTNDWNHANDLER=1
+ CTL_LBTNUPHANDLER=2
  E=SetControlPainter(CTL_WINDOWCTL,"WindowPainter")
+ E=SetControlLMouseUpHandler(CTL_WINDOWCTL,"WindowLMouseUP")
 END
 DEF OTW_INITLIST ARY[]
  VAR I
@@ -185,6 +187,11 @@
  CTL_HANDLER$[CTL AND 4095,CTL_PAINTHANDLER]=HANDLER$
  RETURN 0
 END
+COMMON DEF SetControlLMouseUpHandler(CTL,HANDLER$)
+ IF!CheckControl(CTL)THEN RETURN CTL_INVALIDID
+ CTL_HANDLER$[CTL AND 4095,CTL_LBTNUPHANDLER]=HANDLER$
+ RETURN 0
+END
 DEF CIDNUCIDToCTL(CID,NUCID)
  RETURN CID<<12OR NUCID
 END
@@ -192,6 +199,9 @@
 DEF WIDNUWIDToWND(WID,NUWID)
  RETURN WID<<12OR NUWID
 END
+DEF NUWIDToWND(NUWID)
+ RETURN WIN_WID[NUWID]<<12OR NUWID
+END
 VAR WIN_ROOTWND
 COMMON DEF GetRootWND()
  RETURN WIN_ROOTWND
@@ -201,6 +211,7 @@
 END
 VAR WIN_TopLevelX
 VAR WIN_TopLevelY
+VAR OTW_TOPLEVELCNT
 COMMON DEF NewTopLevelWindow CTL,NAME$,WIDTH,HEIGHT OUT WND,ERR
  IF!CheckControl(CTL)THEN
   WND=0
@@ -213,6 +224,7 @@
   RETURN
  ENDIF
  ERR=0
+ INC OTW_TOPLEVELCNT
  INC WIN_WIDCNT
  VAR NUWID,WID
  NUWID=WIN_FREE
@@ -221,29 +233,127 @@
  WND=WIDNUWIDToWND(WID,NUWID)
  WIN_WID[NUWID]=WID
  WIN_CTL[NUWID]=CTL
+ WIN_NAME$[NUWID]=NAME$
  '
  WIN_X[NUWID]=0
  WIN_Y[NUWID]=0
  
+ WIN_AX[NUWID]=0
+ WIN_AY[NUWID]=0
  WIN_AX[NUWID]=WIN_TopLevelX
  WIN_AY[NUWID]=WIN_TOPLEVELY
  '
  WIN_WIDTH[NUWID]=WIDTH
- WIN_HEIGHT[NUWID]=WIDTH
+ WIN_HEIGHT[NUWID]=HEIGHT
+ WIN_NEXT[NUWID]=0
+ GCLIP 1,0,240,400,480
  VOID RepaintWindow(WND)
- IF!WIN_ROOTWND THEN WIN_NEXT[NUWID]=0RETURN
- VAR C=WIN_CHILD[WIN_ROOTWND AND NUWIDMASK]
- WIN_PARENT[NUWID]=WIN_ROOTWND  AND NUWIDMASK
- WIN_CHILD[WIN_ROOTWND AND NUWIDMASK]=NUWID
- WIN_NEXT[NUWID]=C
- WIN_PREV[C]=NUWID
+ IF!WIN_ROOTWND THEN
+  GFILL WIN_AX[NUWID],WIN_AY[NUWID]+240,WIN_AX[NUWID]+WIN_WIDTH[NUWID],WIN_AY[NUWID]+WIN_HEIGHT[NUWID]+240,ShortToRGB(NUWID)
+  GCLIP 1,0,0,400,240
+' SPSET SP,WIN_AX[NUWID],WIN_AY[NUWID],WIN_WIDTH[NUWID],WIN_HEIGHT[NUWID],1
+' SPSHOW SP
+' SPOFS SP,WIN_AX[NUWID],WIN_AY[NUWID],1023
+  RETURN
+ ENDIF
+ 
+ VAR SP=OTW_TOPLEVELCNT,FRAME
+' IF SPVAR(SP,0)THEN
+  WHILE SPVAR(SP,0)
+   SP=(SP+1)MOD 255
+  WEND
+  FRAME=SP+1
+  WHILE SPVAR(FRAME,0)
+   FRAME=(FRAME+1)MOD 255
+  WEND
+' ENDIF
+ WIN_SP[NUWID]=SP OR FRAME<<10
+ VAR ROOTNUWID=WIN_ROOTWND AND NUWIDMASK
+ VAR C=WIN_CHILD[ROOTNUWID],N
+ WIN_PARENT[NUWID]=ROOTNUWID
+ IF!C THEN
+  WIN_CHILD[ROOTNUWID]=NUWID
+ ELSE
+  N=C
+  WHILE 1
+   C=N
+   N=WIN_NEXT[N]
+   IF!N THEN
+    WIN_NEXT[C]=NUWID
+    WIN_PREV[NUWID]=C
+    BREAK
+   ENDIF
+  WEND
+ ENDIF
  WIN_TopLevelX=WIN_TopLevelX+8
  WIN_TopLevelY=WIN_TopLevelY+8
+ WIN_TopLevelX=WIN_TopLevelX+8
+ WIN_TopLevelY=WIN_TopLevelY+8
+ WIN_AX[NUWID]=WIN_TopLevelX
+ WIN_AY[NUWID]=WIN_TOPLEVELY
+ GFILL WIN_AX[NUWID],WIN_AY[NUWID]+240,WIN_AX[NUWID]+WIN_WIDTH[NUWID],WIN_AY[NUWID]+WIN_HEIGHT[NUWID]+240,ShortToRGB(NUWID)
+ GCLIP 1,0,0,400,240
+ SPSET SP,WIN_AX[NUWID],WIN_AY[NUWID],WIN_WIDTH[NUWID]+1,WIN_HEIGHT[NUWID]+1,1
+ SPOFS SP,WIN_AX[NUWID],WIN_AY[NUWID],0
+ SPSHOW SP
+ SPSET FRAME,0
+ SPSCALE FRAME,WIN_WIDTH[NUWID]+3,WIN_HEIGHT[NUWID]+11
+ SPOFS FRAME,WIN_AX[NUWID]-1,WIN_AY[NUWID]-9,0
+ SPVAR SP,0,WND
+ SPVAR FRAME,0,WND
+ SPCOLOR FRAME,RGB(128,0,0,255)
+ SPCOL FRAME,0,0,WIN_WIDTH[NUWID]+3,WIN_HEIGHT[NUWID]+11
+ OTW_SPSORT
 END
+COMMON DEF OTW_SPSORT
+ VAR I,Z=0
+ IF OTW_TOPLEVELCNT-1THEN Z=(1023+255)/(OTW_TOPLEVELCNT-1)
+ VAR NUWID=WIN_CHILD[WIN_ROOTWND AND NUWIDMASK]
+'IF!WIN_NEXT[NUWID]THEN I=
+ I=1023+255
+ WHILE NUWID
+  I=I-Z
+  SPOFS WIN_SP[NUWID]AND 1023,,,-255+I
+  SPOFS (WIN_SP[NUWID]>>10),,,-255+I+1
+  NUWID=WIN_NEXT[NUWID]
+ WEND
+END
+COMMON DEF FrontWindow(WND)
+ IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
+ VAR NUWID=WND AND NUWIDMASK
+ IF!WIN_NEXT[NUWID]THEN VOID RepaintWindow(WND) RETURN 0
+ VAR N,C=WIN_NEXT[NUWID]
+  N=C
+  WHILE 1
+   C=N
+   N=WIN_NEXT[N]
+   IF!N THEN
+    WIN_NEXT[C]=NUWID
+    WIN_PREV[NUWID]=C
+    WIN_NEXT[NUWID]=0
+    IF WIN_PARENT[NUWID]==(WIN_ROOTWND AND NUWIDMASK) THEN
+     VAR Z,Z2,S
+     SPOFS WIN_SP[NUWID]AND 1023OUT S,S,Z
+     SPOFS WIN_SP[C]AND 1023OUT S,S,Z2
+     SPOFS WIN_SP[NUWID]AND 1023,,,Z2
+     SPOFS WIN_SP[C]AND 1023,,,Z
+     SPOFS WIN_SP[NUWID]>>10,,,Z2+1'1
+     SPOFS WIN_SP[C]>>10,,,Z+1'1
+    ENDIF
+    BREAK
+   ENDIF
+  WEND
+ VOID RepaintWindow(WND)
+ GCLIP 1,0,240,400,480
+ GFILL WIN_AX[NUWID],WIN_AY[NUWID]+240,WIN_AX[NUWID]+WIN_WIDTH[NUWID],WIN_AY[NUWID]+WIN_HEIGHT[NUWID]+240,ShortToRGB(NUWID)
+ GCLIP 1,0,0,400,240
+ RETURN 0
+END
 COMMON DEF SendWindowEvent(WND,TYPE,A1,A2)
  IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
  VAR NUWID=WND AND NUWIDMASK
  IF(WIN_MSGS[NUWID]+1)MOD WIN_MSGMAX==WIN_MSGE[NUWID] THEN RETURN WIN_EVENTERR
+ IF!LEN(CTL_HANDLER$[WIN_CTL[NUWID]AND 4095,TYPE])THEN RETURN 0
  WIN_MSGBUF[NUWID,WIN_MSGS[NUWID],0]=TYPE
  WIN_MSGBUF[NUWID,WIN_MSGS[NUWID],1]=A1
  WIN_MSGBUF[NUWID,WIN_MSGS[NUWID],2]=A2
@@ -254,13 +364,19 @@
 COMMON DEF RepaintWindow(WND)
  RETURN SendWindowEvent(WND,CTL_PAINTHANDLER,0,0)
 END
+COMMON DEF LMouseUpWindow(WND)
+ RETURN SendWindowEvent(WND,CTL_LBTNUPHANDLER,OTW_MOUSEX,OTW_MOUSEY)
+END
+COMMON DEF LMouseDownWindow(WND)
+ RETURN SendWindowEvent(WND,CTL_LBTNDWNHANDLER,OTW_MOUSEX,OTW_MOUSEY)
+END
 COMMON DEF UpdateWindow(WND)
  IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
  VAR NUWID=WND AND NUWIDMASK
  IF WIN_MSGS[NUWID]==WIN_MSGE[NUWID]THEN RETURN 0
  VAR NUCID=WIN_CTL[NUWID] AND 4095
- VAR S=WIN_MSGS[NUWID]
- ?CTL_HANDLER$[NUCID,WIN_MSGBUF[NUWID,S,0]]
+ VAR S=WIN_MSGE[NUWID]
+ ?"HND";CTL_HANDLER$[NUCID,WIN_MSGBUF[NUWID,S,0]]
  CALL CTL_HANDLER$[NUCID,WIN_MSGBUF[NUWID,S,0]],WND,WIN_MSGBUF[NUWID,S,1],WIN_MSGBUF[NUWID,S,2]
  INC WIN_MSGE[NUWID]
  IF WIN_MSGE[NUWID]>=WIN_MSGMAX THEN WIN_MSGE[NUWID]=0
@@ -276,7 +392,7 @@
  VAR AY=WIN_AY[NUWID]
  VAR W=WIN_WIDTH[NUWID]
  VAR H=WIN_HEIGHT[NUWID]
- GPAGE OTW_DP,OTW_BP
+ GPAGE OTW_SP,OTW_BP
  GCLIP 1,0,0,W,H
  GCLS
  RETURN 0
@@ -288,6 +404,7 @@
  'ごうせい
  WIN_PARENT[0]=0
  WIN_NEXT[0]=0
+ WIN_BEGIN[NUWID]=FALSE
  VAR AX=WIN_AX[NUWID]
  VAR AY=WIN_AY[NUWID]
  VAR W=WIN_WIDTH[NUWID]
@@ -296,7 +413,8 @@
  IF WIN_CHILD[NUWID]THEN
   PNUWID=WIN_CHILD[NUWID]
   WHILE PNUWID
-   GCOPY OTW_DP,WIN_AX[PNUWID]+AX,WIN_AY[PNUWID]+AY,WIN_AX[PNUWID]+WIN_WIDTH[PNUWID],WIN_AY[PNUWID]+WIN_HEIGHT[PNUWID],0,0,0  
+GCOPY OTW_DP,WIN_AX[PNUWID]+AX,WIN_AY[PNUWID]+AY,WIN_AX[PNUWID]+WIN_WIDTH[PNUWID],WIN_AY[PNUWID]+WIN_HEIGHT[PNUWID],WIN_AX[PNUWID]-AX,WIN_AY[PNUWID]-AY,0
+'   GCOPY OTW_DP,WIN_AX[PNUWID]+AX,WIN_AY[PNUWID]+AY,WIN_AX[PNUWID]+WIN_WIDTH[PNUWID],WIN_AY[PNUWID]+WIN_HEIGHT[PNUWID],0,0,0  
    PNUWID=WIN_NEXT[PNUWID]
   WEND
  ENDIF
@@ -310,15 +428,21 @@
    PNUWID=WIN_NEXT[PNUWID]
    CONTINUE
   ENDIF
-  GCOPY OTW_DP,WIN_AX[PNUWID]+AX,WIN_AY[PNUWID]+AY,WIN_AX[PNUWID]+WIN_WIDTH[PNUWID],WIN_AY[PNUWID]+WIN_HEIGHT[PNUWID],0,0,0
+  ?WIN_AY[PNUWID],WIN_AX[PNUWID]+AX,WIN_AY[PNUWID]+AY,WIN_AX[PNUWID]+WIN_WIDTH[PNUWID]-AX,WIN_AY[PNUWID]+WIN_HEIGHT[PNUWID]-AY
+'  
+  IF WIN_AX[PNUWID]THEN
+'   GCOPY OTW_DP,WIN_AX[PNUWID],WIN_AY[PNUWID],WIN_AX[PNUWID]+WIN_WIDTH[PNUWID],WIN_AY[PNUWID]+WIN_HEIGHT[PNUWID],-WIN_AX[PNUWID],-WIN_AY[PNUWID],0
+  ELSE
+   GCOPY OTW_DP,WIN_AX[PNUWID]+AX,WIN_AY[PNUWID]+AY,WIN_AX[PNUWID]+WIN_WIDTH[PNUWID],WIN_AY[PNUWID]+WIN_HEIGHT[PNUWID],0,0,0
+  ENDIF
   _NUWID=PNUWID
   PNUWID=WIN_NEXT[PNUWID]
  WEND
- GCLIP 1
- GPAGE OTW_DP,OTW_DP
+ GCLIP 1,0,0,400,240
+ GPAGE OTW_SP,OTW_DP
 ?AX,AY,W,H
  GCOPY OTW_BP,0,0,W,H,AX,AY,0
-DIALOG "A"
+'DIALOG"A
  RETURN 0
 END
 COMMON DEF GPSETWindow WND,X,Y,COL
@@ -330,12 +454,24 @@
 COMMON DEF GBOXWindow WND,X,Y,X2,Y2,COL
  GBOX X,Y,X2,Y2,COL
 END
-COMMON DEF GPRINTWindow WND,X,Y,STR$,FWIDTH,FHEIGHT
- IF FWIDTH==8&&FHEIGHT==8THEN
-  
- ENDIF
+COMMON DEF GPRINTWindow WND,X,Y,STR$
+ VAR L=LEN(STR$)-1,C$,A,BX,BY,I
+ FOR I=0TO L
+  C$=MID$(STR$,I,1)
+  A=ASC(C$)
+  IF A<=&H7F&&A>=&H20THEN
+   A=A-&H20
+   BX=A*8
+   BY=BX/(512-8)
+   GCOPY 5,BX,BY,BX+7,BY+7,X,Y,0
+  ELSE
+   GFILL X,Y,X+7,Y+7,-1
+  ENDIF
+  X=X+8
+ NEXT
 END
 DEF DesktopPainter WND,A1,A2
+'RETURN
  VAR E=GBEGINWindow(WND)
  IF E THEN RETURN
  GFILLWindow WND,0,0,32,32,RGB(255,0,0)
@@ -343,11 +479,34 @@
 END
 DEF WindowPainter WND,A1,A2
 END
+DEF WindowLMouseUP WND,A1,A2
+ VAR E=FrontWindow(WND)
+END
+DEF OTW_INITSP
+ GFILL 408,0,416,8,-1
+ SPDEF 0,408,0,1,1,1
+END
 VAR WIN_ROOTCTL
-  VAR TSTWND,TSTCTL
-  VAR TSTWND2
+VAR TSTWND,TSTCTL
+VAR TSTWND2
+
+VAR OTW_MOUSELBTN
+VAR OTW_MOUSERBTN
+VAR OTW_LMOUSEDWN
+VAR OTW_LMOUSEUP
+VAR OTW_RMOUSEDWN
+VAR OTW_RMOUSEUP
 COMMON DEF I_OTW
  IF!OTW_INIT THEN
+  'ACLS
+  OTW_DP=4
+  OTW_SP=0
+  OTW_BP=1
+  GPAGE OTW_SP,OTW_DP
+  'GCLS' RGB(0,0,255)
+  OTW_INITSP
+  XSCREEN 2
+
   PrintConsole "====================="+LF$()
   PrintConsole "OTYA 3D WINDOW SYSTEM"+LF$()
   PrintConsole "====================="+LF$()
@@ -355,52 +514,108 @@
   OTW_WIN_INITARRAY
   OTW_CTL_INITARRAY
   OTW_INIT_ERR
-  
   VAR E
   NewControl "DESKTOP" OUT WIN_ROOTCTL,E
   E=SetControlPainter(WIN_ROOTCTL,"DesktopPainter")
-  NewTopLevelWindow WIN_ROOTCTL,"",400,240 OUT WIN_ROOTWND,E
+  NewTopLevelWindow WIN_ROOTCTL,"DESKTOP",400,240 OUT WIN_ROOTWND,E
   ExtendControl "HELLO",GetWindowControl() OUT TSTCTL,E
   NewTopLevelWindow TSTCTL,"HELLO",64,64 OUT TSTWND,E
   NewTopLevelWindow TSTCTL,"HELLO",64,64 OUT TSTWND2,E
   E=SetControlPainter(TSTCTL,"HELLOPainter")
-  ACLS
-  XSCREEN 2
-  GCLS RGB(0,0,255)
- ' VISIBLE 0,1,1,1
+  OTW_LOADFONT
+  GCLIP 1,0,0,400,240
+  VISIBLE 1,1,1,1
   OTW_MOUSEX=(400-16)/2
   OTW_MOUSEY=(240-16)/2
   OTW_MOUSEX#=(400-16)/2
   OTW_MOUSEY#=(240-16)/2
- '290
+  
+  OTW_MOUSELBTN=32OR 256
+  OTW_MOUSERBTN=16OR 512
+  OTW_LMOUSEDWN=1
+  OTW_LMOUSEUP =2
+  OTW_RMOUSEDWN=4
+  OTW_RMOUSEUP =8
+  
+  '290
   SPSET OTW_MOUSESP,290
-  SPOFS OTW_MOUSESP,OTW_MOUSEX,OTW_MOUSEY
+  SPOFS OTW_MOUSESP,OTW_MOUSEX,OTW_MOUSEY,-256
+  SPHOME OTW_MOUSESP,0,0
+  SPCOL 0,0,0,1,1
  ENDIF
 RETURN
 END
 COMMON DEF HELLOPainter WND,A1,A2
  VAR E=GBEGINWindow(WND)
  IF E THEN RETURN
- GFILLWindow WND,0,0,64,64,RGB(255,255,0)
+ GFILLWindow WND,0,0,64,64,RGB(0,0,0)
  GBOXWindow WND,0,0,64,64,RGB(128,128,128)
+ GPRINTWindow WND,6,1,CHR$(ASC("A")+(WND AND 4095))+"HELLOOOOOOOO"
  E=GENDWindow(WND)
 END
+VAR OTW_OLDMOUSEX
+VAR OTW_OLDMOUSEY
+DEF OTWGetOvMouseNUWID()
+ RETURN RGBToShort(GSPOIT(OTW_MOUSEX,OTW_MOUSEY+240))
+END
+VAR OTW_OLDLMOUSE
+VAR OTW_OLDRMOUSE
 COMMON DEF L_OTW
-' ?OTW_INIT
+ VAR MOVEMOUSE
  UpdateMouse
+ IF OTW_MOUSEX!=OTW_OLDMOUSEX THEN MOVEMOUSE=1
+ IF OTW_MOUSEY!=OTW_OLDMOUSEY THEN MOVEMOUSE=1
+ VAR NUWID,E
+ VAR BTN=UpdateButton()
+ IF MOVEMOUSE||BTN THEN
+  NUWID=OTWGetOvMouseNUWID()
+ ENDIF
+ IF BTN AND OTW_LMOUSEUP THEN
+  E=LMouseUpWindow(NUWIDToWND(NUWID))
+  ?SPHITSP(OTW_MOUSESP)
+  IF WIN_SP[NUWID]THEN
+   
+  ENDIF
+ ENDIF
+ OTW_OLDMOUSEX=OTW_MOUSEX
+ OTW_OLDMOUSEY=OTW_MOUSEY
  VOID UpdateWindow(TSTWND)
  VOID UpdateWindow(WIN_ROOTWND)
  VOID UpdateWindow(TSTWND2)
 ' ExitProcess 1
 RETURN
 END
-VAR OTW_MOUSEOLDX,OTW_MOUSEOLDY,OTW_MOUSEOLDST
+DEF UpdateButton()
+ VAR B=BUTTON()
+ VAR RET=0
+ IF B AND OTW_MOUSELBTN THEN
+  IF!OTW_OLDLMOUSE THEN RET=OTW_LMOUSEDWN
+  OTW_OLDLMOUSE=1
+ ELSE
+  IF OTW_OLDLMOUSE THEN RET=OTW_LMOUSEUP
+  OTW_OLDLMOUSE=0
+ ENDIF
+ IF B AND OTW_MOUSERBTN THEN
+  IF!OTW_OLDRMOUSE THEN RET=OTW_RMOUSEDWN
+  OTW_OLDRMOUSE=1
+ ELSE
+  IF OTW_OLDRMOUSE THEN RET=OTW_RMOUSEUP
+  OTW_OLDRMOUSE=0
+ ENDIF
+ RETURN RET
+END
+VAR OTW_MOUSEOLDX,OTW_MOUSEOLDY
+VAR OTW_MOUSEOLDST
 COMMON DEF UpdateMouse
  VAR S,X,Y
  TOUCH OUT S,X,Y
  IF OTW_MOUSEOLDST AND S THEN
   OTW_MOUSEX=OTW_MOUSEX+X-OTW_MOUSEOLDX
   OTW_MOUSEY=OTW_MOUSEY+Y-OTW_MOUSEOLDY
+  IF OTW_MOUSEX<0THEN OTW_MOUSEX=0
+  IF OTW_MOUSEY<0THEN OTW_MOUSEY=0
+  IF OTW_MOUSEX>=400THEN OTW_MOUSEX=399
+  IF OTW_MOUSEY>=240THEN OTW_MOUSEY=239
   SPOFS OTW_MOUSESP,OTW_MOUSEX,OTW_MOUSEY
    OTW_MOUSEX#=OTW_MOUSEX
    OTW_MOUSEY#=OTW_MOUSEY
@@ -414,6 +629,10 @@
   IF X#!=0 OR Y#!=0 THEN
    OTW_MOUSEX#=OTW_MOUSEX#+X#/2
    OTW_MOUSEY#=OTW_MOUSEY#-Y#/2
+   IF OTW_MOUSEX#<0THEN OTW_MOUSEX#=0
+   IF OTW_MOUSEY#<0THEN OTW_MOUSEY#=0
+   IF OTW_MOUSEX#>=400THEN OTW_MOUSEX#=399
+   IF OTW_MOUSEY#>=240THEN OTW_MOUSEY#=239
    SPOFS OTW_MOUSESP,OTW_MOUSEX#,OTW_MOUSEY#
    OTW_MOUSEX=OTW_MOUSEX#
    OTW_MOUSEY=OTW_MOUSEY#
@@ -423,10 +642,39 @@
 COMMON DEF OTWSAVE VER$
  SAVE"PRG1:OTW"+VER$
 END
-
+'DEF OTW_LOADMOUSE
+' 
+'END
 DEF OTW_LOADFONT
-' READ C$
- 
+ VAR T$=" !"+CHR$(34)+"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghiijklmnopqrstuvwxyz{|}~¢£¦§¨¨©®±´¶ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿĀāĂăĄąĆćĊċČčĎďĒēĔĕĖėĘęĞğĠġĢģĦħĪīĮįİıĲĳĶķĹĺĻļĽľŁłŃńŅņŇňŐőŒœŔŕŘřŚśŞşŠšŤťŪūŮůŰűŲųŸŹźŻżŽžƒǅǆǲǳȚț˚;΄΅ΆΈΉΊΌΎΏΐΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩΪΫάέήίΰαβγδεζηθικλμνξοπρςστυφχψωϊϋόύώЁАБВГДЕЖЗИЙКЛМНОПРСТУФХЦЧШЩЪЫЬЭЮЯабвгдежзийклмнопрстуфхцчшщъыьэюяё“”†‡…‰※€⇒⇔∀∂∞∴∵⊂⊃⌒☆♀♂♡♧♭、。〃々〆「」『』〒〜〝〟ぁあぃいぅうぇえぉおかがきぎくぐけげこごさざしじすずせぜそぞただちぢっつづてでとどなにぬねのはばぱひびぴふぶぷへべぺほぼぽまみむめもゃやゅゆょよらりるれろわをんゝゞァアィイゥウェエォオカガキギクグケゲコゴサザシジスズセゼソゾタダチヂッツヅテデトドナニヌネノハバパヒビピフブプヘベペホボポマミムメモャヤュユョヨラリルレロワヲンヴ・ー仝｀｜"
+ 'LOAD FONT-1
+ VAR C$
+ OTW_FNT1=NewArray3(&H7F-&H20,8,8)
+ GPAGE 0,5
+ VAR X,Y,I,J
+'RETURN
+ RESTORE @FONT
+ VAR C,_$
+ WHILE 1
+  READ C$
+  IF C$=="END"THEN BREAK
+IF LEN(C$)-1 THEN CONTINUE
+?C$;
+  I=ASC(C$)-&H20
+  X=I*8
+  IF I>=512-8THEN X=I MOD 64Y=1
+' GFILL X,Y,X+8,Y+8,0
+  FOR J=0TO 7
+   READ C$
+   FOR I=0TO LEN(C$)-1
+    _$=MID$(C$,I,1)
+    IF _$=="F"THEN C=-1 ELSE C=0
+    GPSET X+I,Y+J,C
+   NEXT
+  NEXT
+ WEND
+ GPAGE 0,0
+@FONT
 DATA "A"
 DATA "000F0000"
 DATA "00F0F000"
@@ -582,8 +830,8 @@
 DATA "00000000"
 DATA "R"
 DATA "0FFFF000"
-DATA "0R000F00"
 DATA "0F000F00"
+DATA "0F000F00"
 DATA "0FFFF000"
 DATA "0F0F0000"
 DATA "0F00F000"
