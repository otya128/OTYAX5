diff -u OTW.TXT OTW4
--- OTW.TXT
+++ OTW4
@@ -34,6 +34,7 @@
 DIM WIN_PREV   [0]
 DIM WIN_CHILD  [0]
 DIM WIN_PARENT [0]
+DIM WIN_BEGIN  [0]
 'QUEUE
 DIM WIN_MSGS   [0]
 DIM WIN_MSGE   [0]
@@ -43,12 +44,18 @@
 VAR WIN_MSGARGSIZE
 VAR WIDSHIFT
 VAR NUWIDMASK
+'DRAW PAGE
+VAR OTW_DP
+'BUFFER PAGE
+VAR OTW_BP
 DEF OTW_WIN_INITARRAY
  WIN_MAX=256
  WIN_MSGMAX=64
  WIN_MSGARGSIZE=3
  WIDSHIFT=12
  NUWIDMASK=4095
+ OTW_DP=0
+ OTW_BP=1
  WIN_NAME$     =NewArray$(WIN_MAX)
  WIN_WID       =NewArray(WIN_MAX)
  WIN_X         =NewArray(WIN_MAX)
@@ -71,6 +78,7 @@
  WIN_PREV      =NewArray(WIN_MAX)
  WIN_CHILD     =NewArray(WIN_MAX)
  WIN_PARENT    =NewArray(WIN_MAX)
+ WIN_BEGIN     =NewArray(WIN_MAX)
  WIN_MSGS      =NewArray(WIN_MAX)
  WIN_MSGE      =NewArray(WIN_MAX)
  WIN_MSGBUF    =NewArray3(WIN_MAX,WIN_MSGMAX,WIN_MSGARGSIZE)
@@ -196,11 +204,14 @@
  '
  WIN_X[NUWID]=0
  WIN_Y[NUWID]=0
+ 
+ WIN_AX[NUWID]=0
+ WIN_AY[NUWID]=0
  '
  WIN_WIDTH[NUWID]=WIDTH
  WIN_HEIGHT[NUWID]=WIDTH
  VOID RepaintWindow(WND)
- IF!WIN_ROOTWND THEN RETURN
+ IF!WIN_ROOTWND THEN WIN_NEXT[NUWID]=0RETURN
  VAR C=WIN_CHILD[WIN_ROOTWND AND NUWIDMASK]
  WIN_CHILD[WIN_ROOTWND AND NUWIDMASK]=NUWID
  WIN_NEXT[NUWID]=C
@@ -225,20 +236,63 @@
  VAR NUWID=WND AND NUWIDMASK
  IF WIN_MSGS[NUWID]==WIN_MSGE[NUWID]THEN RETURN 0
  ?"A"
+ VAR NUCID=WIN_CTL[NUWID] AND 4095
+ VAR S=WIN_MSGS[NUWID]
+ CALL CTL_HANDLER$[NUCID,WIN_MSGBUF[NUWID,S,0]],WND,WIN_MSGBUF[NUWID,S,1],WIN_MSGBUF[NUWID,S,2]
  INC WIN_MSGE[NUWID]
  IF WIN_MSGE[NUWID]>=WIN_MSGMAX THEN WIN_MSGE[NUWID]=0
  RETURN 0
 END
-''WINDOW GRAPHIC:
-COMMON DEF WindowGBegin(WND)
+''WINDOW GRAPHIC
+COMMON DEF GBEGINWindow(WND)
+ IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
+ VAR NUWID=WND AND NUWIDMASK
+ IF WIN_BEGIN[NUWID]THEN RETURN WIN_EVENTERR
+ WIN_BEGIN[NUWID]=TRUE
+ VAR AX=WIN_AX[NUWID]
+ VAR AY=WIN_AY[NUWID]
+ VAR W=WIN_WIDTH[NUWID]
+ VAR H=WIN_HEIGHT[NUWID]
+ GPAGE OTW_DP,OTW_BP
+ GCLIP 1,AX,AY,AX+W,AY+H
  RETURN 0
 END
-COMMON DEF WindowGPUT WND,X,Y,COL
+COMMON DEF GENDWindow(WND)
+ IF!CheckWindow(WND)THEN RETURN WIN_INVALIDID
+ VAR NUWID=WND AND NUWIDMASK
+ IF!WIN_BEGIN[NUWID]THEN RETURN WIN_EVENTERR
+ 'ごうせい
+ VAR PNUWID=WIN_NEXT[NUWID]
+ WHILE TRUE
+  IF!PNUWID THEN
+   PNUWID=WIN_PARENT[PNUWID]
+   IF!PNUWID THEN BREAK
+   PNUWID=WIN_NEXT[PNUWID]
+   CONTINUE
+  ENDIF
+  GCOPY OTW_DP,WIN_AX[PNUWID],WIN_AY[PNUWID],WIN_AX[PNUWID]+WIN_WIDTH[PNUWID],WIN_AY[PNUWID]+WIN_HEIGHT[PNUWID],0,0,0
+  PNUWID=WIN_NEXT[PNUWID]
+ WEND
+ GPAGE OTW_DP,OTW_DP
+ VAR AX=WIN_AX[NUWID]
+ VAR AY=WIN_AY[NUWID]
+ VAR W=WIN_WIDTH[NUWID]
+ VAR H=WIN_HEIGHT[NUWID]
+ GCOPY OTW_BP,0,0,W,H,AX,AY,0
+ RETURN 0
 END
-COMMON DEF WindowGFILL WND,X,Y,X2,Y2,COL
+COMMON DEF GPSETWindow WND,X,Y,COL
+ GPSET X,Y,COL
 END
-DEF WindowPainter WND
+COMMON DEF GFILLWindow WND,X,Y,X2,Y2,COL
+ GFILL X,Y,X2,Y2,COL
 END
+DEF DesktopPainter WND,A1,A2
+ VAR E=GBEGINWindow(WND)
+ IF E THEN RETURN
+ GFILLWindow WND,0,0,32,32,RGB(255,0,0)
+ E=GENDWindow(WND)
+END
 VAR WIN_ROOTCTL
 COMMON DEF I_OTW
  IF!OTW_INIT THEN
@@ -307,12 +361,175 @@
 
 DEF OTW_FONT
 DATA "A"
+DATA "000F0000"
+DATA "00F0F000"
+DATA "0F000F00"
+DATA "0F000F00"
+DATA "0FFFFF00"
+DATA "0F000F00"
+DATA "0F000F00"
 DATA "00000000"
+DATA "B"
+DATA "0FFFF000"
+DATA "0F000F00"
+DATA "0F000F00"
+DATA "0FFFF000"
+DATA "0F000F00"
+DATA "0F000F00"
+DATA "0FFFF000"
 DATA "00000000"
+DATA "C"
+DATA "00FFF000"
+DATA "0F000F00"
+DATA "0F000000"
+DATA "0F000000"
+DATA "0F000000"
+DATA "0F000F00"
+DATA "00FFF000"
 DATA "00000000"
+DATA "D"
+DATA "0FFF0000"
+DATA "0F00F000"
+DATA "0F000F00"
+DATA "0F000F00"
+DATA "0F000F00"
+DATA "0F00F000"
+DATA "0FFF0000"
 DATA "00000000"
+DATA "E"
+DATA "0FFFFF00"
+DATA "0F000000"
+DATA "0F000000"
+DATA "0FFFF000"
+DATA "0F000000"
+DATA "0F000000"
+DATA "0FFFFF00"
 DATA "00000000"
+DATA "F"
+DATA "0FFFFF00"
+DATA "0F000000"
+DATA "0F000000"
+DATA "0FFFF000"
+DATA "0F000000"
+DATA "0F000000"
+DATA "0F000000"
 DATA "00000000"
+DATA "G"
+DATA "00FFFF00"
+DATA "0F000000"
+DATA "0F000000"
+DATA "0F0FFF00"
+DATA "0F000F00"
+DATA "0F000F00"
+DATA "00FFFF00"
 DATA "00000000"
+DATA "H"
+DATA "0F000F00"
+DATA "0F000F00"
+DATA "0F000F00"
+DATA "0FFFFF00"
+DATA "0F000F00"
+DATA "0F000F00"
+DATA "0F000F00"
 DATA "00000000"
+DATA "I"
+DATA "00FFF000"
+DATA "000F0000"
+DATA "000F0000"
+DATA "000F0000"
+DATA "000F0000"
+DATA "000F0000"
+DATA "00FFF000"
+DATA "00000000"
+DATA "J"
+DATA "000FFF00"
+DATA "0000F000"
+DATA "0000F000"
+DATA "0000F000"
+DATA "0000F000"
+DATA "0F00F000"
+DATA "00FF0000"
+DATA "00000000"
+DATA "B"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "B"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "B"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "B"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "B"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "B"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "B"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "B"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "B"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+DATA "00000000"
+
 END
