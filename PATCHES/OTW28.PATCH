diff -u OTW.TXT OTW28
--- OTW.TXT
+++ OTW28
@@ -663,6 +663,7 @@
  FOR I=0TO LEN(TEXT$)-1
   VOID SendKeyWindow(NUWIDToWND(WIN_ACTIVENUWID),ASC(TEXT$[I]))
  NEXT
+ RETURN 0
 END
 VAR WIN_NOALLOC
 VAR WIN_INVALIDID
@@ -1256,6 +1257,7 @@
  RETURN WID<<12OR NUWID
 END
 DEF NUWIDToWND(NUWID)
+ IF!NUWID THEN RETURN 0
  RETURN WIN_WID[NUWID]<<12OR NUWID
 END
 'WND2 Join WND Group
@@ -2704,6 +2706,9 @@
  WEND
  RETURN 0
 END
+COMMON DEF GetActiveWindow()
+ RETURN NUWIDToWND(WIN_ACTIVENUWID)
+END
 COMMON DEF GetMouseX()
  RETURN OTW_MOUSEX
 END
@@ -2770,6 +2775,11 @@
 COMMON DEF GetTextWidth(STR$)
  RETURN LEN(STR$)*8
 END
+COMMON DEF GetOwnerWindow(WND)
+ VAR GO=GetWindowGroupOwner(WND)
+ IF GO THEN RETURN GO
+ RETURN GetParentWindow(WND)
+END
 COMMON DEF GetParentWindow(WND)
  IF!CheckWindow(WND)THEN
   RETURN 0
@@ -3887,9 +3897,9 @@
   VOID GEndWindow(WND)
  ENDIF
  IF T==CTL_LDBLCLKHANDLER THEN
-  VOID SendNotifWindow(GetParentWindow(WND),WND,0)
+  VOID SendNotifWindow(GetOwnerWindow(WND),WND,0)
  ELSEIF GetWindowVar(WND,6)THEN
-  VOID SendNotifWindow(GetParentWindow(WND),WND,1)
+  VOID SendNotifWindow(GetOwnerWindow(WND),WND,1)
  ENDIF
 END
 COMMON DEF ListBoxChItem()
@@ -4586,7 +4596,7 @@
   CLS
   LOCATE 0,29
 ' NewProcess"LAUNCHER","" OUT E,E
-  NewProcess"TESTIM","" OUT E,E
+  NewProcess"RIM","" OUT E,E
   NewProcess"ODE","" OUT E,E
  ENDIF
 RETURN
@@ -8701,16 +8711,7 @@
    VAR EXT$=GetFileExtension$(I$)
    ToUpper EXT$
    IF EXT$=="LNK"THEN
-    VAR RESULT$
-    LoadFile PATH$ OUT RESULT$,ERR
-    IF 0 THEN DIM K$[0],V$[0]
-    LoadConfigFile RESULT$ OUT K$,V$
-    VAR N=FindArray(K$,"name")
-    VAR F=FindArray(K$,"function")
-    IF N!=-1THEN
-     I$=V$[N]
-    ENDIF
-    AddMenuItem MENU,I$,LEN(ARY)
+    AddMenuItem MENU,GetFileNameWithoutExt$(I$),LEN(ARY)
     PUSH ARY,AllocString(PATH$)
    ELSE
     AddMenuItem MENU,I$,LEN(ARY)
@@ -9482,6 +9483,516 @@
   ExitProcess 0
  ENDIF
 END
+VAR RIM_MODE,RIM_KEYBUF$
+VAR RIM_CTL
+DEF RIM_ISROMA(C)
+ RETURN (C>=65&&C<=65+26)||(C>=97&&C<=97+26)
+END
+'aeiuo
+DEF RIM_ISVOWEL(C)
+ IF C>=97&&C<=97+26THEN C=C-32
+ RETURN C==65||C==69||C==73||C==79||C==85
+END
+DEF RIM_VOWEL$(C)
+ IF C>=97&&C<=97+26THEN C=C-32
+ IF C==65THEN RETURN"あ"
+ IF C==69THEN RETURN"え"
+ IF C==73THEN RETURN"い"
+ IF C==79THEN RETURN"お"
+ IF C==85THEN RETURN"う"
+ RETURN""
+END
+DEF RIM_ADD_DAKUTEN$(K$)
+ RETURN CHR$(ASC(K$)+1)
+END
+DEF RIM_ADD_HDAKUTEN$(K$)
+ RETURN CHR$(ASC(K$)+2)
+END
+DEF RIM_SMALL$(K$)
+ RETURN CHR$(ASC(K$)-1)
+END
+DEF RIM_HIRA$(C$,V$)
+ IF C$==""THEN@A
+ IF C$=="K"THEN@KA
+ IF C$=="Q"THEN@QA
+ IF C$=="C"THEN@CA
+ IF C$=="G"THEN RETURN RIM_ADD_DAKUTEN$(RIM_HIRA$("K",V$))
+ IF C$=="S"THEN@SA
+ IF C$=="Z"THEN RETURN RIM_ADD_DAKUTEN$(RIM_HIRA$("S",V$))
+ IF C$=="SH"THEN@SHA
+ IF C$=="T"THEN@TA
+ IF C$=="D"THEN RETURN RIM_ADD_DAKUTEN$(RIM_HIRA$("T",V$))
+ IF C$=="CH"THEN@CHA
+ IF C$=="N"THEN@NA
+ IF C$=="H"THEN@HA
+ IF C$=="F"THEN@FA
+ IF C$=="B"THEN RETURN RIM_ADD_DAKUTEN$(RIM_HIRA$("H",V$))
+ IF C$=="P"THEN RETURN RIM_ADD_HDAKUTEN$(RIM_HIRA$("H",V$))
+ IF C$=="M"THEN@MA
+ IF C$=="Y"THEN@YA
+ IF C$=="R"THEN@RA
+ IF C$=="W"THEN@WA
+ IF C$=="J"THEN@JA
+ RETURN C$+V$
+ @A
+ IF V$=="A"THEN RETURN"あ"
+ IF V$=="I"THEN RETURN"い"
+ IF V$=="U"THEN RETURN"う"
+ IF V$=="E"THEN RETURN"え"
+ IF V$=="O"THEN RETURN"お"
+ RETURN C$+V$
+ @KA
+ IF V$=="A"THEN RETURN"か"
+ IF V$=="I"THEN RETURN"き"
+ IF V$=="U"THEN RETURN"く"
+ IF V$=="E"THEN RETURN"け"
+ IF V$=="O"THEN RETURN"こ"
+ RETURN C$+V$
+ @QA
+ IF V$=="A"THEN RETURN"くぁ"
+ IF V$=="I"THEN RETURN"くぃ"
+ IF V$=="U"THEN RETURN"く"
+ IF V$=="E"THEN RETURN"くぇ"
+ IF V$=="O"THEN RETURN"くぉ"
+ RETURN C$+V$
+ @CA
+ IF V$=="I"THEN RETURN"し"
+ IF V$=="E"THEN RETURN"せ"
+ GOTO @KA
+ @SA
+ IF V$=="A"THEN RETURN"さ"
+ IF V$=="I"THEN RETURN"し"
+ IF V$=="U"THEN RETURN"す"
+ IF V$=="E"THEN RETURN"せ"
+ IF V$=="O"THEN RETURN"そ"
+ RETURN C$+V$
+ @SHA
+ IF V$=="A"THEN RETURN"しゃ"
+ IF V$=="I"THEN RETURN"し"
+ IF V$=="U"THEN RETURN"しゅ"
+ IF V$=="E"THEN RETURN"しぇ"
+ IF V$=="O"THEN RETURN"しょ"
+ RETURN C$+V$
+ @TA
+ IF V$=="A"THEN RETURN"た"
+ IF V$=="I"THEN RETURN"ち"
+ IF V$=="U"THEN RETURN"つ"
+ IF V$=="E"THEN RETURN"て"
+ IF V$=="O"THEN RETURN"と"
+ RETURN C$+V$
+ @CHA
+ IF V$=="A"THEN RETURN"ちゃ"
+ IF V$=="I"THEN RETURN"ち"
+ IF V$=="U"THEN RETURN"ちゅ"
+ IF V$=="E"THEN RETURN"ちぇ"
+ IF V$=="O"THEN RETURN"ちょ"
+ RETURN C$+V$
+ @NA
+ IF V$=="A"THEN RETURN"な"
+ IF V$=="I"THEN RETURN"に"
+ IF V$=="U"THEN RETURN"ぬ"
+ IF V$=="E"THEN RETURN"ね"
+ IF V$=="O"THEN RETURN"の"
+ RETURN C$+V$
+ @HA
+ IF V$=="A"THEN RETURN"は"
+ IF V$=="I"THEN RETURN"ひ"
+ IF V$=="U"THEN RETURN"ふ"
+ IF V$=="E"THEN RETURN"へ"
+ IF V$=="O"THEN RETURN"ほ"
+ RETURN C$+V$
+ @FA
+ IF V$=="A"THEN RETURN"ふぁ"
+ IF V$=="I"THEN RETURN"ふぃ"
+ IF V$=="U"THEN RETURN"ふ"
+ IF V$=="E"THEN RETURN"ふぇ"
+ IF V$=="O"THEN RETURN"ふぉ"
+ RETURN C$+V$
+ @MA
+ IF V$=="A"THEN RETURN"ま"
+ IF V$=="I"THEN RETURN"み"
+ IF V$=="U"THEN RETURN"む"
+ IF V$=="E"THEN RETURN"め"
+ IF V$=="O"THEN RETURN"も"
+ RETURN C$+V$
+ @YA
+ IF V$=="A"THEN RETURN"や"
+ IF V$=="I"THEN RETURN"い"
+ IF V$=="U"THEN RETURN"ゆ"
+ IF V$=="E"THEN RETURN"いぇ"
+ IF V$=="O"THEN RETURN"よ"
+ RETURN C$+V$
+ @RA
+ IF V$=="A"THEN RETURN"ら"
+ IF V$=="I"THEN RETURN"り"
+ IF V$=="U"THEN RETURN"る"
+ IF V$=="E"THEN RETURN"れ"
+ IF V$=="O"THEN RETURN"ろ"
+ RETURN C$+V$
+ @WA
+ IF V$=="A"THEN RETURN"わ"
+ IF V$=="I"THEN RETURN"うぃ"
+ IF V$=="U"THEN RETURN"う"
+ IF V$=="E"THEN RETURN"うぇ"
+ IF V$=="O"THEN RETURN"を"
+ @JA
+ IF V$=="A"THEN RETURN"じゃ
+ IF V$=="I"THEN RETURN"じ"
+ IF V$=="U"THEN RETURN"じゅ"
+ IF V$=="E"THEN RETURN"じぇ"
+ IF V$=="O"THEN RETURN"じょ"
+ RETURN C$+V$
+END
+DEF RIM_ROMA$(C$,V$)
+ VAR D$=TOUPPER$(C$)
+ VAR W$=TOUPPER$(V$)
+ VAR S$,P$
+ IF LEN(D$)>1&&RIGHT$(D$,1)=="Y"&&RIGHT$(D$,2)!="YY"THEN
+  IF D$[0]!="X"&&D$[0]!="L"THEN
+   D$=LEFT$(D$,LEN(D$)-1)
+   IF W$=="A"THEN S$="ゃ"
+   IF W$=="I"THEN S$="ぃ"
+   IF W$=="U"THEN S$="ゅ"
+   IF W$=="E"THEN S$="ぇ"
+   IF W$=="O"THEN S$="ょ"
+   W$="I"
+  ENDIF
+ ENDIF
+ IF LEN(D$)>1&&(MID$(D$,LEN(D$)-2,1)==RIGHT$(D$,1))THEN
+  D$=LEFT$(D$,LEN(D$)-1)
+  P$="っ"
+ ENDIF
+ IF LEN(D$)>1&&LEFT$(D$,2)!="NN"&&LEFT$(D$,1)=="N"&&!RIM_ISVOWEL(ASC(MID$(D$,1,1)))THEN
+  D$=MID$(D$,1,LEN(D$))
+  INC P$,"ん"
+ ENDIF
+ IF RIGHT$(D$,3)=="SSH"||RIGHT$(D$,3)=="CCH"THEN
+  RemoveStrB D$,LEN(D$)-2,1
+  P$="っ"
+ ENDIF
+ 
+ VAR R$
+ IF LEN(D$)&&D$[0]=="L"||D$[0]=="X"THEN
+  R$=RIM_HIRA$(MID$(D$,1,LEN(D$)),V$)
+  IF R$=="いぇ"THEN
+   R$="ゅ"
+  ELSE
+   R$=RIM_SMALL$(R$)
+  ENDIF
+ ELSE
+  R$=RIM_HIRA$(D$,W$)
+ ENDIF
+ RETURN P$+R$+S$
+END
+DEF RIM_K$(K$)
+ IF RIM_MODE!=3&&RIM_MODE!=2THEN RETURN K$
+ VAR I
+ FOR I=0TO LEN(K$)-1
+  VAR KI$=K$[I]
+  IF RIM_MODE==3&&KI$>="ぁ"&&KI$<="ん"THEN
+   K$[I]=CHR$(ASC(K$[I])+96)
+   CONTINUE
+  ENDIF
+  IF KI$=="-"THEN K$[I]="ー"CONTINUE
+  IF KI$=="."THEN K$[I]="。"CONTINUE
+  IF KI$==","THEN K$[I]="、"CONTINUE
+ NEXT
+ RETURN K$
+END
+VAR RIM_BUF2$
+VAR RIM_WND
+DEF RIM_SENDKEY(IM,K$)
+ SetWindowName RIM_WND,RIM_BUF2$
+ VOID RepaintWindow(RIM_WND)
+ VOID ShowWindow(RIM_WND)
+ PUSH RIM_BUF2$,K$
+END
+DIM RIM_CURBUNSETSU$[0]
+DIM RIM_CURTXT$[0]
+VAR RIM_CONVF
+VAR RIM_SELBUNSETSU
+VAR RIM_CANDWND
+VAR RIM_TARGETWND
+DEF RIM_SEND(IM)
+ VOID FocusWindow(RIM_TARGETWND)
+ RIM_TARGETWND=0
+ IF!LEN(RIM_BUF2$)THEN
+  VOID HideWindow(RIM_WND)
+  VOID DeleteWindow(RIM_CANDWND)
+  IF LEN(RIM_KEYBUF$)THEN
+   VAR RK$=RIM_KEYBUF$
+   RIM_KEYBUF$=""
+   RETURN SendIMText(IM,RK$)
+  ENDIF
+  RETURN SendIMText(IM,CR$())
+ ENDIF
+ IF RIM_CONVF THEN
+  RIM_CONVF=0
+  VAR ERR=SendIMText(IM,Join$(RIM_CURTXT$,""))
+ ELSE
+  ERR=SendIMText(IM,RIM_BUF2$+RIM_KEYBUF$)
+  RIM_KEYBUF$=""
+ ENDIF
+ VOID HideWindow(RIM_WND)
+ VOID DeleteWindow(RIM_CANDWND)
+ RIM_CANDWND=0
+ RIM_BUF2$=""
+ RETURN ERR
+END
+DEF RIM_CALC_X()
+ VAR X,I
+ FOR I=0TO LEN(RIM_CURTXT$)-1
+  IF I==RIM_SELBUNSETSU THEN
+   RETURN X
+  ENDIF
+  X=X+LEN(RIM_CURTXT$[I])*8
+ NEXT
+ RETURN X
+END
+DEF RIM_MAXLEN(A$)
+ VAR I,M=&H80000000
+ FOR I=0TO LEN(A$)-1
+  IF M<LEN(A$[I])THEN
+   M=LEN(A$[I])
+  ENDIF
+ NEXT
+ RETURN M
+END
+DEF RIM_ENTER(IM)
+ IF!LEN(RIM_BUF2$)THEN
+  VAR RK$=RIM_KEYBUF$
+  RIM_KEYBUF$=""
+  RETURN SendIMText(IM,RK$+" ")
+ ENDIF
+ IF RIM_CONVF THEN
+  DIM CAND$[0]
+  OTYIME_GETCAND RIM_CURBUNSETSU$[RIM_SELBUNSETSU] OUT CAND$
+  VAR RW=GetParentWindow(RIM_WND),E
+  VAR Y=GetWindowHeight(RW)-64-8
+  VAR W=RIM_MAXLEN(CAND$)*8+12
+  VAR X=MIN(RW-W,RIM_CALC_X())
+  VAR H=63
+  IF RIM_CANDWND THEN
+   ClearListBox RIM_CANDWND
+   E=MoveResizeWindow(RIM_CANDWND,X,Y,W,H)
+  ELSE
+   NewWindow GetListBoxControl(),"",X,Y,W,H,RW,WindowFrontFlag() OUT RIM_CANDWND,E
+   JoinWindowGroup RIM_WND,RIM_CANDWND OUT E
+  ENDIF
+  VAR I
+  FOR I=0TO LEN(CAND$)-1
+   AddListBoxItem RIM_CANDWND,CAND$[I]
+  NEXT
+  RETURN 0
+ ENDIF
+ RIM_CONVF=TRUE
+ IF 0 THEN DIM A$[0],B$[0]
+ OTYIME_K2K RIM_BUF2$+RIM_KEYBUF$ OUT A$,B$
+ RIM_KEYBUF$=""
+ RIM_CURTXT$=A$
+ RIM_CURBUNSETSU$=B$
+ RIM_SELBUNSETSU=0
+ RIM_BUF2$=Join$(A$,"")
+ SetWindowName RIM_WND,RIM_BUF2$
+ VOID RepaintWindow(RIM_WND)
+ VOID ShowWindow(RIM_WND)
+ RETURN 0'ERR
+END
+DEF RIM_KEY IM,KEY
+ IF!RIM_MODE THEN RETURN
+ IF RIM_MODE==1THEN
+  VOID SendIMText(IM,CHR$(KEY))
+  RETURN
+ ENDIF
+ IF!LEN(RIM_BUF2$)&&KEY==8THEN
+  VOID SendIMText(IM,CHR$(KEY))
+  RETURN
+ ENDIF
+ IF KEY==13THEN
+  VOID RIM_SEND(IM)
+  RETURN
+ ENDIF
+ IF KEY==32THEN
+  VOID RIM_ENTER(IM)
+  RETURN
+ ENDIF
+ IF KEY==8 THEN
+  IF LEN(RIM_KEYBUF$)THEN
+   VOID POP(RIM_KEYBUF$)
+  ELSEIF LEN(RIM_BUF2$)THEN
+   VOID POP(RIM_BUF2$)
+   
+  ENDIF
+  SetWindowName RIM_WND,RIM_BUF2$+RIM_KEYBUF$
+  VOID RepaintWindow(RIM_WND)
+  VOID ShowWindow(RIM_WND)
+  RETURN
+ ENDIF
+ IF!RIM_CONVF THEN
+  VAR W=GetActiveWindow()
+  RIM_TARGETWND=W
+ ENDIF
+ IF!RIM_ISROMA(KEY)THEN
+  IF LEN(RIM_KEYBUF$)THEN
+   IF RIGHT$(RIM_KEYBUF$,1)=="N"THEN
+    RIM_KEYBUF$[LEN(RIM_KEYBUF$)-1]=RIM_K$("ん")
+   ENDIF
+   VOID RIM_SENDKEY(IM,RIM_KEYBUF$)
+   RIM_KEYBUF$=""
+  ENDIF
+  VOID RIM_SENDKEY(IM,RIM_K$(CHR$(KEY)))
+  RETURN
+ ENDIF
+ IF RIM_ISVOWEL(KEY)THEN
+  IF LEN(RIM_KEYBUF$)THEN
+   VOID RIM_SENDKEY(IM,RIM_K$(RIM_ROMA$(RIM_KEYBUF$,CHR$(KEY))))
+   RIM_KEYBUF$=""
+   RETURN
+  ENDIF
+  VOID RIM_SENDKEY(IM,RIM_K$(RIM_VOWEL$(KEY)))
+  RETURN
+ ENDIF
+ PUSH RIM_KEYBUF$,CHR$(KEY)
+ SetWindowName RIM_WND,RIM_BUF2$+RIM_KEYBUF$
+ VOID RepaintWindow(RIM_WND)
+ VOID ShowWindow(RIM_WND)
+ IF ToUpper$(RIM_KEYBUF$)=="NN"THEN
+  VOID RIM_SENDKEY(IM,RIM_K$("ん"))
+  RIM_KEYBUF$=""
+  RETURN
+ ENDIF
+END
+VAR RIM_WV_BTNRPT
+COMMON DEF RIMNOTIF WND,CTL,TYP,A1,A2
+ IF A1==RIM_CANDWND THEN
+  VAR T$=GetListBoxSelectedText$(A1)
+  IF!LEN(T$)THEN RETURN
+  RIM_CURTXT$[RIM_SELBUNSETSU]=T$
+  VOID DeleteWindow(A1)
+  RIM_CANDWND=0
+  VOID RepaintWindow(WND)
+ ENDIF
+END
+COMMON DEF RIMBTN WND,CTL,TYP,BTN,__
+ VAR MC=GetWindowVar(WND,RIM_WV_BTNRPT)
+ IF ABS(MC-MAINCNT)<10 THEN
+  RETURN
+ ENDIF
+ VOID DeleteWindow(RIM_CANDWND)
+ RIM_CANDWND=0
+ SetWindowVar WND,RIM_WV_BTNRPT,MAINCNT
+ IF BTN==#LEFT&&RIM_SELBUNSETSU>0 THEN
+  DEC RIM_SELBUNSETSU
+  VOID RepaintWindow(WND)
+ ENDIF
+ IF BTN==#RIGHT&&LEN(RIM_CURTXT$)>RIM_SELBUNSETSU+1 THEN
+  INC RIM_SELBUNSETSU
+  VOID RepaintWindow(WND)
+ ENDIF
+ IF BTN==#UP&&LEN(RIM_CURTXT$)>RIM_SELBUNSETSU+1 THEN
+  PUSH RIM_CURBUNSETSU$[RIM_SELBUNSETSU],RIM_CURBUNSETSU$[RIM_SELBUNSETSU+1][0]
+  IF LEN(RIM_CURBUNSETSU$[RIM_SELBUNSETSU+1])==1THEN
+   COPY RIM_CURTXT$,RIM_SELBUNSETSU+1,RIM_CURTXT$,RIM_SELBUNSETSU+2,LEN(RIM_CURBUNSETSU$)-RIM_SELBUNSETSU-2
+   COPY RIM_CURBUNSETSU$,RIM_SELBUNSETSU+1,RIM_CURBUNSETSU$,RIM_SELBUNSETSU+2,LEN(RIM_CURBUNSETSU$)-RIM_SELBUNSETSU-2
+   VOID POP(RIM_CURBUNSETSU$)
+   VOID POP(RIM_CURTXT$)
+   RIM_CURTXT$[RIM_SELBUNSETSU]=RIM_CURBUNSETSU$[RIM_SELBUNSETSU]
+  ELSE
+   VOID SHIFT(RIM_CURBUNSETSU$[RIM_SELBUNSETSU+1])
+   RIM_CURTXT$[RIM_SELBUNSETSU]=RIM_CURBUNSETSU$[RIM_SELBUNSETSU]
+   RIM_CURTXT$[RIM_SELBUNSETSU+1]=RIM_CURBUNSETSU$[RIM_SELBUNSETSU+1]
+  ENDIF
+  VOID RepaintWindow(WND)
+ ENDIF
+ IF BTN==#DOWN THEN
+  IF LEN(RIM_CURBUNSETSU$[RIM_SELBUNSETSU])==1THEN RETURN
+  IF LEN(RIM_CURTXT$)==RIM_SELBUNSETSU+1THEN
+   PUSH RIM_CURTXT$,""
+   PUSH RIM_CURBUNSETSU$,""
+  ENDIF
+  UNSHIFT RIM_CURBUNSETSU$[RIM_SELBUNSETSU+1],POP(RIM_CURBUNSETSU$[RIM_SELBUNSETSU])
+  RIM_CURTXT$[RIM_SELBUNSETSU]=RIM_CURBUNSETSU$[RIM_SELBUNSETSU]
+  RIM_CURTXT$[RIM_SELBUNSETSU+1]=RIM_CURBUNSETSU$[RIM_SELBUNSETSU+1]
+  VOID RepaintWindow(WND)
+ ENDIF
+END
+COMMON DEF RIMPAINT WND,CTL,TYP,XY,WH
+ IF GBeginWindow(WND)THEN RETURN
+ GCLSWindow WND,-1
+ IF RIM_CONVF THEN
+  VAR I,L=LEN(RIM_CURTXT$)-1,X
+  FOR I=0TO L
+   VAR C$=RIM_CURTXT$[I]
+   IF RIM_SELBUNSETSU==I THEN
+    GFILLWindow WND,X,0,X+LEN(C$)*8-1,7,GetSelectionColor()
+    GPRINTWindow WND,X,0,C$,GetSelectionTextColor()
+   ELSE
+    GPRINTWindow WND,X,0,C$,#BLACK
+   ENDIF
+   X=X+LEN(C$)*8
+  NEXT
+ ELSE
+  GPRINTWindow WND,0,0,GetWindowName$(WND),#BLACK
+ ENDIF
+ IF GEndWindow(WND)THEN RETURN
+END
+COMMON DEF I_RIM
+ IF!CHKCALL("IsWinRunning")||!IsWinRunning()THEN
+  PrintConsole "Require window system"+LF$()
+  ExitProcess 1
+  RETURN
+ ENDIF
+ VAR E
+ NewControl "RIM" OUT RIM_CTL,E
+ E=SetControlPainter(RIM_CTL,"RIMPAINT")
+ E=SetControlButtonHandler(RIM_CTL,"RIMBTN")
+ E=SetControlNotifHandler(RIM_CTL,"RIMNOTIF")
+ VAR RWND=GetRootWindow()
+ VAR WND
+ NewWindow RIM_CTL,"",0,GetWindowHeight(RWND)-7,GetWindowWidth(RWND),7,RWND,WindowFrontFlag() OUT WND,E
+ VOID HideWindow(WND)
+ RIM_WND=WND
+ VAR IM,ERR
+ NewIM OUT IM,ERR
+ IF ERR THEN
+  ExitProcess ERR
+  RETURN
+ ENDIF
+ ERR=SetIMKeyHandler(IM,"RIM_KEY")
+ 
+ SetProcessVar IM
+ KEY 1,"KEY OFF"
+ EXEC 2
+ OTYIME_INIT
+ CLS
+END
+COMMON DEF L_RIM
+ VAR X,Y,MMM
+ TOUCH OUT MMM,X,Y
+ IF MMM&&!OTW_ENKEY_STATE&&X>=5&&X<=63&&Y>=5&&Y<=16THEN
+  OTW_ENKEY_STATE=1
+  RIM_MODE=(RIM_MODE+1)MOD 4
+  IF RIM_MODE==1 THEN
+   KEY 1,"KEY ON"
+  ELSEIF RIM_MODE==2THEN
+   KEY 1,"かな ON"
+  ELSEIF RIM_MODE==3THEN
+   KEY 1,"カナ ON"
+  ELSE
+   KEY 1,"KEY OFF"
+  ENDIF
+  BEEP 9
+ ENDIF
+ IF!MMM THEN OTW_ENKEY_STATE=0
+ IF ProcessIM(GetProcessVar())THEN
+  VOID DeleteIM(GetProcessVar())
+  ExitProcess 0
+ ENDIF
+ IF RIM_CONVF THEN VOID ActiveWindow(RIM_WND)
+ IF UpdateWindow(RIM_WND)THEN
+  RETURN
+ ENDIF
+END
 VAR OTWTERMCTL
 DIM OTWTERMCOLORTBL[0]
 COMMON DEF OTWTERMKEY WND,CTL,TYP,A1,A2
@@ -9901,11 +10412,13 @@
  IF GetWindowVar(WND,2)THEN
   VAR M=GetWindowVar(WND,0)
   IF!M THEN
-   M=MILLISEC+2000
+   M=MILLISEC+5000
    SetWindowVar WND,0,M
   ENDIF
   IF M>=MILLISEC THEN
    VOID RepaintWindow(WND)
+  ELSE
+   SetWindowVar WND,2,FALSE
   ENDIF
   SetWindowVar WND,1,GetWindowVar(WND,1)+1
  ENDIF
@@ -9927,7 +10440,7 @@
   OTWBENCH_MENU_NEW=1
  ENDIF
  VAR MENU
- NewTopLevelStyleWindow OTWBENCHCTL,"Benchmark",128,64,WINDOWMENUSTYLE() OUT WND,E
+ NewTopLevelStyleWindow OTWBENCHCTL,"Benchmark",128,32,WINDOWMENUSTYLE() OUT WND,E
  NewMenu OUT MENU,E
  AddMenuItem MENU,"New",OTWBENCH_MENU_NEW
  AddSubMenuItem GetWindowMenu(WND),"File",MENU
