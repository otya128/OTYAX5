diff -u OTW.TXT OTW22
--- OTW.TXT
+++ OTW22
@@ -277,6 +277,46 @@
  MENU_FREE=1
  VAR E
 END
+'FILE
+VAR ASSOC_LEN
+DIM ASSOC_TYP$[0]
+DIM ASSOC_EXT$[0]
+DIM ASSOC_NAME$[0]
+DEF OTW_ASSOC_INIT
+ ASSOC_TYP$=NewArray$(0)
+ ASSOC_EXT$=NewArray$(0)
+ ASSOC_NAME$=NewArray$(0)
+ VAR E=AssociateFile("TXT","","EDITORSEL")
+ E=AssociateFile("TXT","TXT","TXTED")
+ E=AssociateFile("TXT","PRG","PRGED")
+ E=AssociateFile("TXT","MML","MPLAY")
+END
+DEF GetAssociatedIndex(TYP$,EXT$)
+ VAR I
+ FOR I=0TO ASSOC_LEN-1
+  IF ASSOC_EXT$[I]==EXT$&&ASSOC_TYP$[I]==TYP$THEN 
+   RETURN I
+  ENDIF
+ NEXT
+ RETURN -1
+END
+COMMON DEF GetAssociatedProgram$(TYP$,EXT$)
+ VAR I=GetAssociatedIndex(TYP$,EXT$)
+ IF I!=-1THEN RETURN ASSOC_NAME$[I]
+ RETURN ""
+END
+COMMON DEF AssociateFile(TYP$,EXT$,NAME$)
+ VAR I=GetAssociatedIndex(TYP$,EXT$)
+ IF I!=-1THEN
+  ASSOC_NAME$[I]=NAME$
+  RETURN 0
+ ENDIF
+ PUSH ASSOC_EXT$,EXT$
+ PUSH ASSOC_TYP$,TYP$
+ PUSH ASSOC_NAME$,NAME$
+ INC ASSOC_LEN
+ RETURN 0
+END
 'IF!CHKCALL("IsWinRunning")||!IsWinRunning()THEN
 'ExitProcess 1
 'ENDIF
@@ -701,11 +741,15 @@
 '->ClipboardSetText
 VAR CLPBRD
 VAR CLPBRDCTXT
+VAR CLPBRDCFIL
+VAR CLPBRDFIL$
+VAR CLPBRDFILCUT
 VAR CLPBRD$
 VAR CLPBRD#
 VAR CLPBRDPTR
 COMMON DEF ClearClipboard
  CLPBRDCTXT=FALSE
+ CLPBRDCFIL=FALSE
 END
 COMMON DEF ClipboardContainsText()
  RETURN CLPBRDCTXT
@@ -718,6 +762,23 @@
  CLPBRDCTXT=1
  CLPBRD$=V$
 END
+COMMON DEF ClipboardContainsFile()
+ RETURN CLPBRDCFIL
+END
+COMMON DEF ClipboardGetFile OUT ISCUT,PATH$
+ IF CLPBRDCFIL THEN
+  PATH$=CLPBRDFIL$
+  ISCUT=CLPBRDFILCUT
+  RETURN
+ ENDIF
+ ISCUT=FALSE
+ PATH$=""
+END
+COMMON DEF ClipboardSetFile ISCUT,PATH$
+ CLPBRDFIL$=PATH$
+ CLPBRDFILCUT=ISCUT
+ CLPBRDCFIL=TRUE
+END
 COMMON DEF NewImage WIDTH,HEIGHT OUT IMG,E
  IF !IMAGE_FREE THEN IMG=0:E=IMAGE_NOALLOC:RETURN
  VAR PTR=malloc(WIDTH*HEIGHT)
@@ -3784,6 +3845,7 @@
   OTW_WIN_INITARRAY
   OTW_CTL_INITARRAY
   OTW_INIT_ERR
+  OTW_ASSOC_INIT
   PrintConsoleln "Init setting..."
   OTW_USEBTN=&B11001111
   OTW_FPS=1
@@ -5616,6 +5678,10 @@
  NewWindow GetTextBoxExControl(),"",0,0,128,64,WND,0 OUT TED,E
  TextBoxExSetText TED,LF$()
  SetWindowVar WND,0,TED
+ VAR CMD$=GetCommandArgsWithoutName$(GetProcessArgs$())
+ IF LEN(CMD$)THEN
+  TextBoxExSetText GetWindowVar(WND,0),LoadFile$(CMD$)
+ ENDIF
 'SetTextBoxExPRGMode WND,TRUE
 END
 COMMON DEF L_TXTED
@@ -5650,6 +5716,10 @@
  TextBoxExSetText TED,LF$()
  SetWindowVar WND,0,TED
  SetTextBoxExPRGMode TED,TRUE
+ VAR CMD$=GetCommandArgsWithoutName$(GetProcessArgs$())
+  IF LEN(CMD$)THEN
+   TextBoxExSetText GetWindowVar(WND,0),LoadFile$(CMD$)
+  ENDIF
 END
 COMMON DEF L_PRGED
  IF UpdateWindow(GetProcessVar())THEN ExitProcess 1
@@ -6720,6 +6790,13 @@
  IF UpdateWindow(GetProcessVar())THEN ExitProcess 1
 END
 '===OTYA DOCUMENT EDITOR===
+VAR OTYFIL_MOPEN
+VAR OTYFIL_MCOPY
+VAR OTYFIL_MCUT
+VAR OTYFIL_MDEL
+VAR OTYFIL_MREN
+VAR OTYFIL_MABOUT
+VAR OTYFIL_MPASTE
 DIM OTYFILICOTXT[0]
 DIM OTYFILICODAT[0]
 DIM OTYFILICON[0]
@@ -6734,11 +6811,9 @@
  COPY OTYFILICON,ICONS,16*16*2,16*16
 END
 VAR OTYFILCTL
-VAR OTYFILESWND
-VAR OTYFILES$[0]
 VAR OTYFILICONCTL
 VAR OTYFILABOUTCTL
-VAR OTYFILLBLCTL
+VAR OTYFILRENCTL
 COMMON DEF OTYFILICONCTLPainter W,C,T,_,__
  IF GBeginWindow(W)THEN RETURN
  VAR SEL=GetWindowVar(W,3)
@@ -6776,95 +6851,248 @@
  S$="OK"
  NewWindow GetButtonControl(),S$,(WI-LEN(S$)*8)/2+2,24,LEN(S$)*8+2,12,WND,0 OUT W,E
 END
-COMMON DEF OTYFILLMouse WND,CTL,T,A1,A2
- SetWindowBackColor GetWindowVar(WND,1),WIN_BKGND
- SetWindowVar WND,1,0
- SetString GetWindowVar(WND,2),""
+DEF OTYFIL_GETSELECTEDFILE$ WND OUT F$
+ VAR ARY$=GetString$(GetWindowVar(WND,3))
+ VAR KL=LEN(ARY$)
+ VAR SELECT=GetWindowVar(WND,4)
+ F$=""
+ IF SELECT<0||KL<SELECT THEN RETURN
+ F$=GetString$(ASC(ARY$[SELECT])OR ASC(ARY$[SELECT+1])<<16)
 END
-COMMON DEF OTYFILICONCTLMouse WND,CTL,T,A1,A2
- VAR W=WND
- IF!LEN(GetWindowName$(WND))THEN
-  W=GetWindowVar(W,2)
+DEF OTYFIL_OPEN WND
+ VAR F$=OTYFIL_GETSELECTEDFILE$(WND)
+ IF F$==""THEN RETURN
+ VAR TYP$
+ IF F$[0]==" "THEN
+  TYP$="DAT"
  ENDIF
- VAR PW=GetParentWindow(WND)
- VAR OLD=GetWindowVar(PW,1)
- IF OLD==W THEN RETURN
- IF OLD THEN
-  SetWindowBackColor OLD,WIN_BKGND
+ IF F$[0]=="*"THEN
+  TYP$="TXT"
  ENDIF
- SetWindowBackColor W,RGB(0,0,255)
- SetWindowVar PW,1,W
- SetString GetWindowVar(PW,2),GetWindowName$(W)
+ F$=MID$(F$,1,99999)
+ VAR EXT$=GetFileExtension$(F$)
+ VAR PRG$=GetAssociatedProgram$(TYP$,EXT$)
+ VAR PRC,E
+ NewProcess PRG$,F$ OUT PRC,E
 END
-COMMON DEF OTYFILDEL WND,CTL,T,A1,A2
- FreeString GetWindowVar(WND,2)
+DEF OTYFIL_COPY WND
+ VAR F$=OTYFIL_GETSELECTEDFILE$(WND)
+ IF F$==""THEN RETURN
+ ClearClipboard
+ ClipboardSetFile FALSE,F$
 END
-COMMON DEF OTYFILNOTIF WND,CTL,T,ID,POS
- IF ID<=6THEN
-  VAR E=NewModalDialogBox(OTYFILABOUTCTL,"ABOUT",128,40,WND)
+DEF OTYFIL_CUT WND
+ VAR F$=OTYFIL_GETSELECTEDFILE$(WND)
+ IF F$==""THEN RETURN
+ ClearClipboard
+ ClipboardSetFile TRUE,F$
+END
+'
+'From[HOGEHOGE.TXT]
+'To  [FUGAFUGA.TXT]
+'       [OK]
+COMMON DEF OTYFILRENCREATE WND,CTL,T,A1,A2
+ VAR W=GetWindowWidth(WND)
+ VAR H=GetWindowHeight(WND)
+ VAR FROM=LEN("FROM")*8+8
+ VAR E,W2,FROMW,TOW
+ VAR FROM$=GetWindowName$(WND)
+ NewWindow GetLabelControl(),"From",1,1,32,7,WND,0 OUT W2,E
+ NewWindow GetLabelControl(),"To",1,11,16,7,WND,0 OUT W2,E
+ NewWindow GetTextBoxControl(),FROM$,FROM,0,W-FROM,9,WND,0 OUT FROMW,E
+ NewWindow GetTextBoxControl(),"",FROM,11,W-FROM,9,WND,0 OUT TOW,E
+ VAR BW=24
+ NewWindow GetButtonControl(),"OK",(W-BW) DIV 2,22,BW,10,WND,0 OUT W2,E
+ SetWindowName WND,"Rename"
+ SetWindowVar WND,0,FROMW
+ SetWindowVar WND,1,TOW
+ IF FROM$[0]==" "THEN
+  SetWindowVar WND,2,1
+ ENDIF
+END
+COMMON DEF OTYFILRENNOTIF WND,CTL,T,A1,A2
+ VAR FROMW,TOW
+ GetWindowVar WND,0OUT FROMW
+ GetWindowVar WND,1OUT TOW
+ VAR FROM$=GetWindowName$(FROMW)
+ VAR TO$=GetWindowName$(TOW)
+ RenameFile FROM$,TO$
+ VOID DeleteWindow(WND)
+END
+DEF OTYFIL_DEL WND
+ VAR F$=OTYFIL_GETSELECTEDFILE$(WND)
+ IF F$==""THEN RETURN
+ DeleteFile F$
+END
+DEF OTYFIL_PASTE WND
+ IF!ClipboardContainsFile()THEN
   RETURN
  ENDIF
- VAR I=GetNextWindow(GetChildWindow(WND))
- IF BeginWindowOP(WND)THEN RETURN
- POS=POS*2
- VAR W=36*4+8,H=64
- VAR R=W/36
- VAR C=CEIL(H/40.0)
+ VAR CUT,F$
+ ClipboardGetFile OUT CUT,F$
+ ?"PASTE:",F$
+END
+DEF OTYFIL_REN WND
+ VAR F$=OTYFIL_GETSELECTEDFILE$(WND)
+ IF F$==""THEN RETURN
+ VAR E=NewModalDialogBox(OTYFILRENCTL,F$,40+15*8+4,32,WND)
+END
+COMMON DEF OTYFILLDBL WND,CTL,T,X,Y
+ OTYFILLMouse WND,CTL,T,X,Y
+ OTYFIL_OPEN WND
+END
+VAR OTYFIL_CONTEXTMENU
+COMMON DEF OTYFILRMouse WND,CTL,T,X,Y
+ ShowContextMenu OTYFIL_CONTEXTMENU,WND
+END
+COMMON DEF OTYFILLMouse WND,CTL,T,X,Y
+ VAR S=GetChildWindow(WND)
+ VAR POS=GetScrollBarPosition(S)*2
+ VAR WIDTH=GetWindowWidth(WND)
+ VAR HEIGHT=GetWindowHeight(WND)
+ VAR R=WIDTH DIV 42
  VAR BY1=(POS MOD 40)+7
  VAR BY2=(POS MOD 40)-9
- IF OTYFILESWND!=WND THEN
-  GetFiles OTYFILES$,""
-  OTYFILESWND=WND
- ENDIF
-' ?R,C,POS,POS DIV 16,POS DIV 40,BY1
- VAR X=0,Y=7'-22
- VAR J
- VAR L2=R*2
- VAR F
  VAR K=(POS DIV 40)*R
- VAR KL=LEN(OTYFILES$)
- VAR N$
- VAR SW=GetwindowVar(WND,1)
- VAR SN$=GetString$(GetwindowVar(WND,2))
- WHILE I
-  IF J&&!(J MOD L2) THEN INC Y,41X=0
-  IF F THEN
-   IF KL<=K THEN
-    VOID MoveWindow2(I,-256,-256)
-   ELSE
-    VOID MoveWindow2(I,X,Y-BY2)
-    N$=RIGHT$(OTYFILES$[K],LEN(OTYFILES$[K])-1)
-    IF N$==SN$THEN
-     SetWindowBackColor I,RGB(0,0,255)
-     SetWindowVar WND,1,I
-    ENDIF
-    IF SW==I THEN
-     IF N$!=SN$THEN
-      SetWindowBackColor SW,WIN_BKGND
-     ENDIF
-    ENDIF
-    SetWindowName I,N$
-   ENDIF
-   INC K
-   INC X,36
+ VAR ARY$=GetString$(GetWindowVar(WND,3))
+ VAR KL=LEN(ARY$)
+ VAR W=42
+ VAR H=40
+ K=K+((Y+(POS MOD 40)) DIV H)*R
+ K=K+X DIV W
+ K=K*2
+ IF GetWindowVar(WND,4)!=K THEN
+  SetWindowVar WND,4,K
+  OTYFILPAINT WND,CTL,T,0,0
+ ENDIF
+END
+COMMON DEF OTYFILDEL WND,CTL,T,A1,A2
+ FreeString GetWindowVar(WND,2)
+ StrArrayFree GetWindowVar(WND,3)
+END
+DEF OTYFILGETSCRBARLEN(WND)
+ VAR CW=GetChildWindow(WND)
+ VAR W=GetWindowWidth(WND)
+ VAR OL=W DIV 42
+ VAR LEN=LEN(GetString$(GetWindowVar(WND,3)))
+ VAR AW=(LEN DIV OL)*10
+ RETURN AW
+END
+COMMON DEF OTYFILRESIZ WND,CTL,T,A1,WH
+ VAR W,H
+ SplitInt WH OUT W,H
+ IF W<0||H<0THEN RETURN
+ VAR CW=GetChildWindow(WND)
+ SetScrollBarSize CW,OTYFILGETSCRBARLEN(WND)
+ VOID MoveResizeWindow(CW,W-GetWindowWidth(CW),0,GetWindowWidth(CW),H)
+END
+COMMON DEF OTYFILPAINT WND,CTL,T,A1,A2
+ IF CallBaseControlHandler(WND,CTL,T,A1,A2)THEN RETURN
+ IF GBeginWindow(WND)THEN RETURN
+ GCLSWindow WND,GetBackColor()
+ VAR S=GetChildWindow(WND)
+ VAR POS=GetScrollBarPosition(S)*2
+ VAR WIDTH=GetWindowWidth(WND)
+ VAR HEIGHT=GetWindowHeight(WND)
+ VAR R=WIDTH DIV 42
+ VAR BY1=(POS MOD 40)+7
+ VAR BY2=(POS MOD 40)-9
+ VAR X=0,Y=7
+ VAR K=((POS DIV 40)*R)*2
+ VAR ARY$=GetString$(GetWindowVar(WND,3))
+ VAR KL=LEN(ARY$)
+ VAR W=42
+ VAR H=40
+ VAR SELECT=GetWindowVar(WND,4)
+ VAR IX=(40-16) DIV 2
+ VAR C=RGB(0,0,0)
+ WHILE K<KL
+  VAR F$=GetString$(ASC(ARY$[K])OR ASC(ARY$[K+1])<<16)
+  IF F$[0]==" "THEN
+   GLOADWindow WND,X+IX,Y-BY1,16,16,OTYFILICODAT,1,0
   ELSE
-   IF KL<=K THEN
-    VOID MoveWindow2(I,-256,-256)
-   ELSE
-    VOID MoveWindow2(I,X+8,Y-BY1)
-    IF OTYFILES$[K][0]==" "THEN
-     SetWindowVar I,1,1
-    ELSE
-     SetWindowVar I,1,0
-    ENDIF
-   ENDIF
+   GLOADWindow WND,X+IX,Y-BY1,16,16,OTYFILICOTXT,1,0
   ENDIF
-  F=!F
-  I=GetNextWindow(I)
-  INC J
+  IF SELECT==K THEN
+   GFILLWindow WND,X,Y-BY2,X+39,Y-BY2+23,RGB(0,0,255)
+   C=-1
+  ENDIF
+  VAR L=LEN(F$)-1
+  IF L<=5 THEN 
+  GPRINTWindow WND,X+(5-L)*4,Y-BY2,MID$(F$,1,5),C
+  ELSEIF L>10THEN
+   GPRINTWindow WND,X,Y-BY2+8,MID$(F$,6,5),C
+   GPRINTWindow WND,X+((5-(L-10))*4),Y-BY2+16,MID$(F$,11,4),C
+   GPRINTWindow WND,X,Y-BY2,MID$(F$,1,5),C
+  ELSEIF L>5THEN
+   GPRINTWindow WND,X+((5-(L-5))*4),Y-BY2+8,MID$(F$,6,5),C
+   GPRINTWindow WND,X,Y-BY2,MID$(F$,1,5),C
+  ENDIF
+  X=X+W
+  IF X+W>=WIDTH THEN
+   X=0
+   IF Y>=HEIGHT THEN BREAK
+   Y=Y+H
+  ENDIF
+  IF SELECT==K THEN
+   C=RGB(0,0,0)
+  ENDIF
+  K=K+2
  WEND
- IF EndWindowOP(WND)THEN RETURN
+ IF GENDWindow(WND)THEN RETURN
 END
+COMMON DEF OTYFILNOTIF WND,CTL,T,ID,POS
+ IF!ID THEN
+  IF POS==OTYFIL_MOPEN THEN
+   OTYFIL_OPEN WND
+   RETURN
+  ENDIF
+  IF POS==OTYFIL_MCOPY THEN
+   OTYFIL_COPY WND
+   RETURN
+  ENDIF
+  IF POS==OTYFIL_MCUT THEN
+   OTYFIL_CUT WND
+   RETURN
+  ENDIF
+  IF POS==OTYFIL_MDEL THEN
+   OTYFIL_DEL WND
+   RETURN
+  ENDIF
+  IF POS==OTYFIL_MREN THEN
+   OTYFIL_REN WND
+   RETURN
+  ENDIF
+  IF POS==OTYFIL_MPASTE THEN
+   OTYFIL_PASTE WND
+   RETURN
+  ENDIF
+  VAR E=NewModalDialogBox(OTYFILABOUTCTL,"ABOUT",128,40,WND)
+  RETURN
+ ENDIF
+ OTYFILPAINT WND,CTL,T,0,0
+ RETURN
+END
+DEF StrArrayGetFiles PTR,DIR$
+ DIM FILES$[0]
+ GetFiles FILES$,""
+ VAR S$=CHR$(0)*(2*LEN(FILES$))
+ VAR I,L=LEN(FILES$)-1
+ FOR I=0TO L
+  VAR A=AllocString(FILES$[I])
+  S$[I*2]=CHR$(A)
+  S$[I*2+1]=CHR$(A>>16)
+ NEXT
+ SetString PTR,S$
+END
+DEF StrArrayFree PTR
+ VAR OLD$=GetString$(PTR)
+ VAR I,L=LEN(OLD$)-1
+ FOR I=0 TO L STEP 2
+  VAR J=ASC(OLD$[I])OR ASC(OLD$[I+1])<<16
+  FreeString J
+ NEXT
+END
 COMMON DEF I_OTYFIL
  IF!CHKCALL("IsWinRunning")||!IsWinRunning()THEN
   PrintConsole "Require window system"+LF$()
@@ -6874,58 +7102,53 @@
  VAR WND,E
  IF!OTYFILCTL THEN
   ExtendControl "Files",GetWindowControl() OUT OTYFILCTL,E
-  ExtendControl "FilesLabel",GetLabelControl() OUT OTYFILLBLCTL,E
   E=SetControlNotifHandler(OTYFILCTL,"OTYFILNOTIF")
+  E=SetControlPainter(OTYFILCTL,"OTYFILPAINT")
+  E=SetControlResizeHandler(OTYFILCTL,"OTYFILRESIZ")
   E=SetControlDeleteHandler(OTYFILCTL,"OTYFILDEL")
   E=SetControlLMouseDownHandler(OTYFILCTL,"OTYFILLMouse")
+  E=SetControlRMouseUpHandler(OTYFILCTL,"OTYFILRMouse")
+  E=SetControlLDoubleClickHandler(OTYFILCTL,"OTYFILLDBL")
   NewControl "OTYFILICON" OUT OTYFILICONCTL,E
   E=SetControlPainter(OTYFILICONCTL,"OTYFILICONCTLPainter")
-  E=SetControlLMouseDownHandler(OTYFILICONCTL,"OTYFILICONCTLMouse")
-  E=SetControlLMouseDownHandler(OTYFILLBLCTL,"OTYFILICONCTLMouse")
   RC_OTYFIL
   ExtendControl "FilesAbout",GetWindowControl() OUT OTYFILABOUTCTL,E
   E=SetControlNotifHandler(OTYFILABOUTCTL,"OTYFILABOUTNOTIF")
   E=SetControlCreateHandler(OTYFILABOUTCTL,"OTYFILABOUTCREATE")
+  ExtendControl "Files_Rename",GetWindowControl() OUT OTYFILRENCTL,E
+  E=SetControlCreateHandler(OTYFILRENCTL,"OTYFILRENCREATE")
+  E=SetControlNotifHandler(OTYFILRENCTL,"OTYFILRENNOTIF")
  ENDIF
- VAR W=36*4+8,H=64,LBL
- NewTopLevelMenuWindow OTYFILCTL,"Files",W,H OUT WND,E
+ VAR W=42*4+8,H=64,LBL
+ NewTopLevelStyleWindow OTYFILCTL,"Files",W,H,WINDOWMENUSTYLE()OR WINDOWRESIZABLESTYLE() OUT WND,E
  VAR MENU
  NewMenu OUT MENU,E
- AddMenuItem MENU,"Open",1
- AddMenuItem MENU,"Copy",2
- AddMenuItem MENU,"Move",3
- AddMenuItem MENU,"Delete",4
- AddMenuItem MENU,"Rename",5
+ OTYFIL_MOPEN=1
+ OTYFIL_MCOPY=2
+ OTYFIL_MCUT=3
+ OTYFIL_MDEL=4
+ OTYFIL_MREN=5
+ OTYFIL_MABOUT=6
+ OTYFIL_MPASTE=7
+ AddMenuItem MENU,"Open",OTYFIL_MOPEN
+'AddMenuItem MENU,"Copy",OTYFIL_MCOPY
+'AddMenuItem MENU,"Cut",OTYFIL_MCUT
+'AddMenuItem MENU,"Paste",OTYFIL_MPASTE
+ AddMenuItem MENU,"Delete",OTYFIL_MDEL
+ AddMenuItem MENU,"Rename",OTYFIL_MREN
  AddSubMenuItem GetWindowMenu(WND),"File",MENU
+ OTYFIL_CONTEXTMENU=MENU
  NewMenu OUT MENU,E
- AddMenuItem MENU,"About",6
+ AddMenuItem MENU,"About",OTYFIL_MABOUT
  AddSubMenuItem GetWindowMenu(WND),"Help",MENU
- VAR X=8,Y,I
- OTYFILES$=NewArray$(0)
- GetFiles OTYFILES$,""
- OTYFILESWND=WND
- VAR R=W/36
- VAR C=CEIL(H/40.0)+1
- VAR L=R*C
- IF LEN(OTYFILES$)<=L THEN L=LEN(OTYFILES$)-1
- VAR ICN
- FOR I=0TO L'LEN(OTYFILES$)-1
-  IF X+32+4>W THEN INC Y,40:X=8
-'  IF Y+16>=H THEN BREAK
-  NewWindow OTYFILLBLCTL,RIGHT$(OTYFILES$[I],LEN(OTYFILES$[I])-1),X-8,Y+16,32,24,WND,0 OUT LBL,E
-  SetLabelAlignCenter LBL
-  SetWindowVar LBL,2,LBL
-  NewWindow OTYFILICONCTL,"",X,Y,15,15,WND,0 OUT ICN,E
-  IF OTYFILES$[I][0]==" "THEN SetWindowVar ICN,1,1
-  SetWindowVar ICN,2,LBL
-  INC X,32+4
- NEXT
  VAR SCR
- VAR OL=W/36
- VAR AW=FLOOR(LEN(OTYFILES$)/OL)*20
- NewVScrollBAR WND,AW OUT SCR,E
  SetProcessVar WND
  SetWindowVar WND,2,AllocString("")
+ VAR PTR=AllocString("")
+ StrArrayGetFiles PTR,""
+ SetWindowVar WND,3,PTR
+ NewVScrollBAR WND,OTYFILGETSCRBARLEN(WND) OUT SCR,E
+ SetWindowVar WND,4,-1'SELECTED
  OTYFILNOTIF WND,0,0,WND,0
 END
 COMMON DEF L_OTYFIL
@@ -6981,7 +7204,8 @@
  SetProcessVar WND
  VAR W2
  NewWindow GetButtonControl(),"",0,0,10,10,WND,0 OUT W2,E
- NewWindow GetLabelControl(),"",12,2,128-12,8,WND,1 OUT W2,E
+ VAR CMD$=GetCommandArgsWithoutName$(GetProcessArgs$())
+ NewWindow GetLabelControl(),CMD$,12,2,128-12,8,WND,1 OUT W2,E
  SetWindowVar WND,0,W2
 END
 COMMON DEF L_MPLAY
@@ -7571,13 +7795,14 @@
   VOID RepaintWindow(WND)
  ENDIF
 END
-DEF SUGOIGPRINTWindow WND,X,Y,W,H,TXT$,COL
+DEF SUGOIGPRINTWindow WND,X,Y,W,H,TXT$,COL OUT OX,OY
  W=W DIV 8
  H=H DIV 8
  VAR I,J
  VAR LF$=LF$()
  WHILE 1
   VAR T$=MID$(TXT$,I,W)
+  IF!LEN(T$)THEN BREAK
   VAR LFPOS=INSTR(T$,LF$)
   IF LFPOS!=-1THEN
    T$=MID$(T$,0,LFPOS)
@@ -7587,9 +7812,11 @@
   ENDIF
   GPRINTWindow WND,X,Y,T$,COL
   J=J+1
-  IF H<J THEN RETURN
+  IF H<J THEN BREAK
   Y=Y+8
  WEND
+ OX=X
+ OY=Y
 END
 COMMON DEF CLIPBRDPAINTER WND,CTL,TYP,A1,A2
  VAR E=CallBaseControlHandler(WND,CTL,TYP,A1,A2)
@@ -7602,11 +7829,24 @@
  ENDIF
  VAR W=GETWINDOWWIDTH(WND)
  VAR H=GETWINDOWHEIGHT(WND)
+ VAR X,Y
  IF ClipboardContainsText()THEN
   VAR TXT$=ClipboardGetText$()
-  SUGOIGPRINTWindow WND,0,0,W,H,TXT$,RGB(0,0,0)
+  
+  SUGOIGPRINTWindow WND,0,Y,W,H-Y,"Text:",RGB(0,0,0) OUT X,Y
+  SUGOIGPRINTWindow WND,0,Y,W,H-Y,TXT$,RGB(0,0,0) OUT X,Y
  ELSE
  ENDIF
+ IF ClipboardContainsFile()THEN
+  VAR CUT,FILE$
+  ClipboardGetFile OUT CUT,FILE$
+  IF!CUT THEN
+   SUGOIGPRINTWindow WND,0,Y,W,H-Y,"File:",RGB(0,0,0) OUT X,Y
+  ELSE
+   SUGOIGPRINTWindow WND,0,Y,W,H-Y,"File(cut):",RGB(0,0,0) OUT X,Y
+  ENDIF
+  SUGOIGPRINTWindow WND,0,Y,W,H-Y,FILE$,RGB(0,0,0) OUT X,Y
+ ENDIF
  E=GEndWindow(WND)
 END
 COMMON DEF I_CLIPBRD
@@ -7636,4 +7876,35 @@
 COMMON DEF L_CLIPBRD
  IF UpdateWindow(GetProcessVar())THEN ExitProcess 1
 END
+VAR EDITORSELCTL
+COMMON DEF EDITORSELNOTIF A,B,C,D,E
+ IF E==0THEN
+  VAR CMD$=GetCommandArgsWithoutName$(GetProcessArgs$())
+  VAR PRC
+  NewProcess GetListBoxSelectedText$(D),CMD$ OUT PRC,E
+  VOID DeleteWindow(A)
+ ENDIF
+END
+COMMON DEF I_EDITORSEL
+ IF!CHKCALL("IsWinRunning")||!IsWinRunning()THEN
+  PrintConsole "Require window system"+LF$()
+  ExitProcess 1
+  RETURN
+ ENDIF
+ VAR WND,E
+ IF!EDITORSELCTL THEN
+  ExtendControl "EditorSelector",GetWindowControl() OUT EDITORSELCTL,E
+  E=SetControlNotifHandler(EDITORSELCTL,"EDITORSELNOTIF")
+ ENDIF
+ NewTopLevelWindow EDITORSELCTL,"EditorSelector",128,40 OUT WND,E
+ SetProcessVar WND
+ VAR CMD$=GetCommandArgsWithoutName$(GetProcessArgs$())
+ NewWindow GetLabelControl(),"Open "+CMD$,1,1,128,7,WND,0 OUT E,E
+ NewWindow GetListBoxControl(),"",0,9,127,32,WND,0 OUT WND,E
+ AddListBoxItem WND,"TXTED"
+ AddListBoxItem WND,"PRGED"
+END
+COMMON DEF L_EDITORSEL
+ IF UpdateWindow(GetProcessVar())THEN ExitProcess 1
+END
 
